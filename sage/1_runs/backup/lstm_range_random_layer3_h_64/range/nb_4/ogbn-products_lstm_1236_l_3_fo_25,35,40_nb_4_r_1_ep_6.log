Using backend: pytorch
main start at this time 1648254645.804088
#nodes: 2449029
#edges: 123718024
#classes: 47
success----------------------------------------
196571
39255
2164782
# Nodes: 2400608
# Edges: 123718024
# Train: 196571
# Val: 39255
# Test: 2164782
# Classes: 47

in feats:  100
----------------------------------------before generate_dataloader_block 
 Nvidia-smi: 2.0242919921875 GB
    Memory Allocated: 0.0006527900695800781  GigaBytes
Max Memory Allocated: 0.0006527900695800781  GigaBytes

The real block id is  2
get_global_graph_edges_ids_block function  spend 0.38088154792785645
range selection method range initialization spend 0.03008890151977539
time for parepare:  0.2777681350708008
local_output_nid generation:  0.013150453567504883
local_in_edges_tensor generation:  0.045897483825683594
mini_batch_src_global generation:  0.054119110107421875
r_  generation:  0.9152047634124756
local_output_nid generation:  0.014000654220581055
local_in_edges_tensor generation:  0.02838730812072754
mini_batch_src_global generation:  0.07170343399047852
r_  generation:  0.9797110557556152
local_output_nid generation:  0.013728857040405273
local_in_edges_tensor generation:  0.025079965591430664
mini_batch_src_global generation:  0.059407949447631836
r_  generation:  1.042142629623413
local_output_nid generation:  0.014081716537475586
local_in_edges_tensor generation:  0.021188735961914062
mini_batch_src_global generation:  0.06496930122375488
r_  generation:  1.1064224243164062
----------------------check_connections_block total spend ----------------------------- 5.3633198738098145
generate_one_block  6.358584642410278
generate_one_block  1.1833763122558594
generate_one_block  1.1731243133544922
generate_one_block  1.1650781631469727
The real block id is  1
get_global_graph_edges_ids_block function  spend 2.04440975189209
gen group dst list time:  0.09276795387268066
time for parepare:  0.4122917652130127
local_output_nid generation:  0.14901089668273926
local_in_edges_tensor generation:  0.6139752864837646
mini_batch_src_global generation:  0.7906720638275146
r_  generation:  10.925500869750977
local_output_nid generation:  0.2646505832672119
local_in_edges_tensor generation:  0.7286844253540039
mini_batch_src_global generation:  1.0396728515625
r_  generation:  10.975497722625732
local_output_nid generation:  0.27377986907958984
local_in_edges_tensor generation:  0.8933639526367188
mini_batch_src_global generation:  1.045306921005249
r_  generation:  11.570364952087402
local_output_nid generation:  0.2857184410095215
local_in_edges_tensor generation:  1.4334948062896729
mini_batch_src_global generation:  0.9871416091918945
r_  generation:  11.090517282485962
----------------------check_connections_block total spend ----------------------------- 60.87165188789368
generate_one_block  14.447152137756348
generate_one_block  14.546332120895386
generate_one_block  14.082136392593384
generate_one_block  14.534571409225464
The real block id is  0
get_global_graph_edges_ids_block function  spend 2.144395589828491
gen group dst list time:  0.27075767517089844
time for parepare:  0.4669792652130127
local_output_nid generation:  0.4260852336883545
local_in_edges_tensor generation:  1.245166301727295
mini_batch_src_global generation:  1.1827678680419922
r_  generation:  17.217785596847534
local_output_nid generation:  0.6252288818359375
local_in_edges_tensor generation:  1.3209896087646484
mini_batch_src_global generation:  1.6111061573028564
r_  generation:  17.965152502059937
local_output_nid generation:  0.6508288383483887
local_in_edges_tensor generation:  1.4700927734375
mini_batch_src_global generation:  1.5790205001831055
r_  generation:  17.524335145950317
local_output_nid generation:  0.6176650524139404
local_in_edges_tensor generation:  1.306123971939087
mini_batch_src_global generation:  1.6296494007110596
r_  generation:  17.547873973846436
----------------------check_connections_block total spend ----------------------------- 96.89903974533081
generate_one_block  22.59015464782715
generate_one_block  22.223721504211426
generate_one_block  22.325191736221313
generate_one_block  23.070720195770264
-----------------------------------------after block dataloader generation 
 Nvidia-smi: 2.0242919921875 GB
    Memory Allocated: 0.0006527900695800781  GigaBytes
Max Memory Allocated: 0.0006527900695800781  GigaBytes

connection checking time:  157.7706916332245
block generation total time  147.81998014450073
average batch blocks generation time:  36.95499503612518
----------------------------------------before batch_pred = model(blocks, batch_inputs) 
 Nvidia-smi: 3.4188232421875 GB
    Memory Allocated: 1.3173437118530273  GigaBytes
Max Memory Allocated: 1.3173437118530273  GigaBytes

Traceback (most recent call last):
  File "pseudo_mini_batch_range_products_sage.py", line 455, in <module>
    main()
  File "pseudo_mini_batch_range_products_sage.py", line 451, in main
    best_test = run(args, device, data)
  File "pseudo_mini_batch_range_products_sage.py", line 276, in run
    batch_pred = model(blocks, batch_inputs)#------------*
  File "/home/cc/.local/lib/python3.6/site-packages/torch/nn/modules/module.py", line 727, in _call_impl
    result = self.forward(*input, **kwargs)
  File "/home/cc/graph_partition_multi_layers/pseudo_mini_batch_full_batch/SAGE/graphsage_model_products.py", line 48, in forward
    x = layer(block, x)
  File "/home/cc/.local/lib/python3.6/site-packages/torch/nn/modules/module.py", line 727, in _call_impl
    result = self.forward(*input, **kwargs)
  File "/home/cc/.local/lib/python3.6/site-packages/dgl/nn/pytorch/conv/sageconv.py", line 258, in forward
    graph.update_all(msg_fn, self._lstm_reducer)
  File "/home/cc/.local/lib/python3.6/site-packages/dgl/heterograph.py", line 4849, in update_all
    ndata = core.message_passing(g, message_func, reduce_func, apply_node_func)
  File "/home/cc/.local/lib/python3.6/site-packages/dgl/core.py", line 337, in message_passing
    ndata = invoke_udf_reduce(g, rfunc, msgdata, orig_nid=orig_nid)
  File "/home/cc/.local/lib/python3.6/site-packages/dgl/core.py", line 143, in invoke_udf_reduce
    bkt_rsts.append(func(nbatch))
  File "/home/cc/.local/lib/python3.6/site-packages/dgl/nn/pytorch/conv/sageconv.py", line 173, in _lstm_reducer
    _, (rst, _) = self.lstm(m, h)
  File "/home/cc/.local/lib/python3.6/site-packages/torch/nn/modules/module.py", line 727, in _call_impl
    result = self.forward(*input, **kwargs)
  File "/home/cc/.local/lib/python3.6/site-packages/torch/nn/modules/rnn.py", line 582, in forward
    self.dropout, self.training, self.bidirectional, self.batch_first)
RuntimeError: CUDA out of memory. Tried to allocate 64.00 MiB (GPU 0; 23.62 GiB total capacity; 20.84 GiB already allocated; 5.44 MiB free; 21.00 GiB reserved in total by PyTorch)
