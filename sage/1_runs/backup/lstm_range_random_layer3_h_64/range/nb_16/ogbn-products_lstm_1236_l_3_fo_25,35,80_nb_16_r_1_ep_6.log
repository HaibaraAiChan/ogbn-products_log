main start at this time 1648267789.8329563
#nodes: 2449029
#edges: 123718024
#classes: 47
success----------------------------------------
196571
39255
2164782
# Nodes: 2400608
# Edges: 123718024
# Train: 196571
# Val: 39255
# Test: 2164782
# Classes: 47

in feats:  100
----------------------------------------before generate_dataloader_block 
 Nvidia-smi: 2.0242919921875 GB
    Memory Allocated: 0.0006527900695800781  GigaBytes
Max Memory Allocated: 0.0006527900695800781  GigaBytes

The real block id is  2
get_global_graph_edges_ids_block function  spend 0.6938855648040771
range selection method range initialization spend 0.028931856155395508
time for parepare:  0.373751163482666
local_output_nid generation:  0.0035486221313476562
local_in_edges_tensor generation:  0.03384876251220703
mini_batch_src_global generation:  0.025064945220947266
r_  generation:  0.35619235038757324
local_output_nid generation:  0.003829479217529297
local_in_edges_tensor generation:  0.014230966567993164
mini_batch_src_global generation:  0.033136606216430664
r_  generation:  0.41013383865356445
local_output_nid generation:  0.0037844181060791016
local_in_edges_tensor generation:  0.0055065155029296875
mini_batch_src_global generation:  0.023209810256958008
r_  generation:  0.419771671295166
local_output_nid generation:  0.0037794113159179688
local_in_edges_tensor generation:  0.00553584098815918
mini_batch_src_global generation:  0.025409698486328125
r_  generation:  0.45027780532836914
local_output_nid generation:  0.0037801265716552734
local_in_edges_tensor generation:  0.005155324935913086
mini_batch_src_global generation:  0.02785181999206543
r_  generation:  0.46695828437805176
local_output_nid generation:  0.0038068294525146484
local_in_edges_tensor generation:  0.005333423614501953
mini_batch_src_global generation:  0.03080916404724121
r_  generation:  0.4914977550506592
local_output_nid generation:  0.003713369369506836
local_in_edges_tensor generation:  0.005585908889770508
mini_batch_src_global generation:  0.03142809867858887
r_  generation:  0.49994611740112305
local_output_nid generation:  0.003737926483154297
local_in_edges_tensor generation:  0.004994630813598633
mini_batch_src_global generation:  0.03290963172912598
r_  generation:  0.5024886131286621
local_output_nid generation:  0.003714323043823242
local_in_edges_tensor generation:  0.005272388458251953
mini_batch_src_global generation:  0.034087181091308594
r_  generation:  0.5117912292480469
local_output_nid generation:  0.0037298202514648438
local_in_edges_tensor generation:  0.005452632904052734
mini_batch_src_global generation:  0.03530740737915039
r_  generation:  0.5050797462463379
local_output_nid generation:  0.003687620162963867
local_in_edges_tensor generation:  0.005637645721435547
mini_batch_src_global generation:  0.03731107711791992
r_  generation:  0.519906759262085
local_output_nid generation:  0.0037245750427246094
local_in_edges_tensor generation:  0.005608081817626953
mini_batch_src_global generation:  0.03867363929748535
r_  generation:  0.5188522338867188
local_output_nid generation:  0.0037453174591064453
local_in_edges_tensor generation:  0.005258321762084961
mini_batch_src_global generation:  0.03941702842712402
r_  generation:  0.5312209129333496
local_output_nid generation:  0.0037453174591064453
local_in_edges_tensor generation:  0.005452632904052734
mini_batch_src_global generation:  0.03965902328491211
r_  generation:  0.5226209163665771
local_output_nid generation:  0.003731966018676758
local_in_edges_tensor generation:  0.005329132080078125
mini_batch_src_global generation:  0.04108142852783203
r_  generation:  0.5275471210479736
local_output_nid generation:  0.0036933422088623047
local_in_edges_tensor generation:  0.005414724349975586
mini_batch_src_global generation:  0.04146981239318848
r_  generation:  0.5297694206237793
----------------------check_connections_block total spend ----------------------------- 10.15923523902893
generate_one_block  5.6201512813568115
generate_one_block  0.5052707195281982
generate_one_block  0.5198490619659424
generate_one_block  0.49605751037597656
generate_one_block  0.5069434642791748
generate_one_block  0.503389835357666
generate_one_block  0.5093307495117188
generate_one_block  0.5064840316772461
generate_one_block  0.5012049674987793
generate_one_block  0.5044553279876709
generate_one_block  0.5182328224182129
generate_one_block  0.5061407089233398
generate_one_block  0.5046072006225586
generate_one_block  0.5043716430664062
generate_one_block  0.4984700679779053
generate_one_block  0.5042390823364258
The real block id is  1
get_global_graph_edges_ids_block function  spend 2.532938003540039
gen group dst list time:  0.23490262031555176
time for parepare:  0.4544351100921631
local_output_nid generation:  0.10143232345581055
local_in_edges_tensor generation:  0.45621466636657715
mini_batch_src_global generation:  0.5190670490264893
r_  generation:  6.378467082977295
local_output_nid generation:  0.13887691497802734
local_in_edges_tensor generation:  0.38776087760925293
mini_batch_src_global generation:  0.6431941986083984
r_  generation:  6.749690771102905
local_output_nid generation:  0.15076112747192383
local_in_edges_tensor generation:  0.41716623306274414
mini_batch_src_global generation:  0.6553707122802734
r_  generation:  6.750779151916504
local_output_nid generation:  0.1587209701538086
local_in_edges_tensor generation:  0.5794730186462402
mini_batch_src_global generation:  0.6519465446472168
r_  generation:  6.790339946746826
local_output_nid generation:  0.16319990158081055
local_in_edges_tensor generation:  0.4425983428955078
mini_batch_src_global generation:  0.6738214492797852
r_  generation:  6.953381776809692
local_output_nid generation:  0.19048619270324707
local_in_edges_tensor generation:  0.5035104751586914
mini_batch_src_global generation:  0.6758882999420166
r_  generation:  6.973383903503418
local_output_nid generation:  0.17165184020996094
local_in_edges_tensor generation:  0.45456552505493164
mini_batch_src_global generation:  0.7249894142150879
r_  generation:  7.037951707839966
local_output_nid generation:  0.19254350662231445
local_in_edges_tensor generation:  0.6870348453521729
mini_batch_src_global generation:  0.7196254730224609
r_  generation:  6.9249560832977295
local_output_nid generation:  0.18077969551086426
local_in_edges_tensor generation:  0.45165157318115234
mini_batch_src_global generation:  0.6834895610809326
r_  generation:  7.088281631469727
local_output_nid generation:  0.17315888404846191
local_in_edges_tensor generation:  0.4555625915527344
mini_batch_src_global generation:  0.7037203311920166
r_  generation:  7.0211968421936035
local_output_nid generation:  0.20378613471984863
local_in_edges_tensor generation:  0.5700922012329102
mini_batch_src_global generation:  0.6920650005340576
r_  generation:  7.1041975021362305
local_output_nid generation:  0.17479491233825684
local_in_edges_tensor generation:  0.44916844367980957
mini_batch_src_global generation:  0.7142510414123535
r_  generation:  7.154800891876221
local_output_nid generation:  0.17970681190490723
local_in_edges_tensor generation:  0.559746265411377
mini_batch_src_global generation:  0.6913797855377197
r_  generation:  7.015828847885132
local_output_nid generation:  0.19487905502319336
local_in_edges_tensor generation:  0.46572089195251465
mini_batch_src_global generation:  0.6904845237731934
r_  generation:  7.1872029304504395
local_output_nid generation:  0.17531371116638184
local_in_edges_tensor generation:  0.4564685821533203
mini_batch_src_global generation:  0.6965255737304688
r_  generation:  7.096425294876099
local_output_nid generation:  0.20486044883728027
local_in_edges_tensor generation:  0.6004414558410645
mini_batch_src_global generation:  0.7034432888031006
r_  generation:  6.977006435394287
----------------------check_connections_block total spend ----------------------------- 151.96112704277039
generate_one_block  9.85912823677063
generate_one_block  9.297062635421753
generate_one_block  8.978543996810913
generate_one_block  9.038312673568726
generate_one_block  9.180846214294434
generate_one_block  8.930216073989868Using backend: pytorch

generate_one_block  9.248695135116577
generate_one_block  9.035558462142944
generate_one_block  8.997373580932617
generate_one_block  9.239949941635132
generate_one_block  8.966817617416382
generate_one_block  9.03082013130188
generate_one_block  9.129610300064087
generate_one_block  8.991740942001343
generate_one_block  9.170451879501343
generate_one_block  8.953265190124512
The real block id is  0
get_global_graph_edges_ids_block function  spend 2.113436698913574
gen group dst list time:  0.9850976467132568
time for parepare:  0.4871330261230469
local_output_nid generation:  0.47406721115112305
local_in_edges_tensor generation:  1.2766234874725342
mini_batch_src_global generation:  1.119825839996338
r_  generation:  14.960495710372925
local_output_nid generation:  0.5758428573608398
local_in_edges_tensor generation:  1.2371814250946045
mini_batch_src_global generation:  1.6146183013916016
r_  generation:  15.512605905532837
local_output_nid generation:  0.5993962287902832
local_in_edges_tensor generation:  1.378176212310791
mini_batch_src_global generation:  1.5376033782958984
r_  generation:  15.255272388458252
local_output_nid generation:  0.6011991500854492
local_in_edges_tensor generation:  1.1891169548034668
mini_batch_src_global generation:  1.4564220905303955
r_  generation:  15.227209091186523
local_output_nid generation:  0.6059315204620361
local_in_edges_tensor generation:  1.187631607055664
mini_batch_src_global generation:  1.4057228565216064
r_  generation:  15.313193082809448
local_output_nid generation:  0.5659041404724121
local_in_edges_tensor generation:  2.2584831714630127
mini_batch_src_global generation:  1.4329586029052734
r_  generation:  15.193961143493652
local_output_nid generation:  0.6146717071533203
local_in_edges_tensor generation:  1.1642403602600098
mini_batch_src_global generation:  1.522141456604004
r_  generation:  15.294334173202515
local_output_nid generation:  0.618927001953125
local_in_edges_tensor generation:  1.2089543342590332
mini_batch_src_global generation:  1.4105148315429688
r_  generation:  15.449197769165039
local_output_nid generation:  0.6009113788604736
local_in_edges_tensor generation:  1.2305829524993896
mini_batch_src_global generation:  1.4497714042663574
r_  generation:  15.203495025634766
local_output_nid generation:  0.5987513065338135
local_in_edges_tensor generation:  1.1011500358581543
mini_batch_src_global generation:  1.6691648960113525
r_  generation:  16.60352373123169
local_output_nid generation:  0.6280817985534668
local_in_edges_tensor generation:  1.2309134006500244
mini_batch_src_global generation:  1.9913785457611084
r_  generation:  15.577131509780884
local_output_nid generation:  0.6262922286987305
local_in_edges_tensor generation:  1.2392256259918213
mini_batch_src_global generation:  1.4936089515686035
r_  generation:  15.403606414794922
local_output_nid generation:  0.6211636066436768
local_in_edges_tensor generation:  1.223214864730835
mini_batch_src_global generation:  1.4225845336914062
r_  generation:  15.426202297210693
local_output_nid generation:  0.5847740173339844
local_in_edges_tensor generation:  1.23482084274292
mini_batch_src_global generation:  1.511902093887329
r_  generation:  15.29976773262024
local_output_nid generation:  0.6095714569091797
local_in_edges_tensor generation:  1.1082136631011963
mini_batch_src_global generation:  1.549891710281372
r_  generation:  15.42616319656372
local_output_nid generation:  0.6293880939483643
local_in_edges_tensor generation:  1.2404506206512451
mini_batch_src_global generation:  1.4880225658416748
r_  generation:  15.323842763900757
----------------------check_connections_block total spend ----------------------------- 344.6718680858612
generate_one_block  20.33352041244507
generate_one_block  20.49781060218811
generate_one_block  20.820530891418457
generate_one_block  20.290098190307617
generate_one_block  20.196492433547974
generate_one_block  20.342997550964355
generate_one_block  21.2877938747406
generate_one_block  20.4632511138916
generate_one_block  20.4620144367218
generate_one_block  20.116548776626587
generate_one_block  20.049907445907593
generate_one_block  20.120490312576294
generate_one_block  20.169344425201416
generate_one_block  20.276169776916504
generate_one_block  20.270139455795288
generate_one_block  20.62447214126587
-----------------------------------------after block dataloader generation 
 Nvidia-smi: 2.0242919921875 GB
    Memory Allocated: 0.0006527900695800781  GigaBytes
Max Memory Allocated: 0.0006527900695800781  GigaBytes

connection checking time:  496.6329951286316
block generation total time  472.3699748516083
average batch blocks generation time:  29.523123428225517
----------------------------------------before batch_pred = model(blocks, batch_inputs) 
 Nvidia-smi: 3.3094482421875 GB
    Memory Allocated: 1.206529140472412  GigaBytes
Max Memory Allocated: 1.206529140472412  GigaBytes

Traceback (most recent call last):
  File "pseudo_mini_batch_range_products_sage.py", line 455, in <module>
    main()
  File "pseudo_mini_batch_range_products_sage.py", line 451, in main
    best_test = run(args, device, data)
  File "pseudo_mini_batch_range_products_sage.py", line 276, in run
    batch_pred = model(blocks, batch_inputs)#------------*
  File "/home/cc/.local/lib/python3.6/site-packages/torch/nn/modules/module.py", line 727, in _call_impl
    result = self.forward(*input, **kwargs)
  File "/home/cc/graph_partition_multi_layers/pseudo_mini_batch_full_batch/SAGE/graphsage_model_products.py", line 48, in forward
    x = layer(block, x)
  File "/home/cc/.local/lib/python3.6/site-packages/torch/nn/modules/module.py", line 727, in _call_impl
    result = self.forward(*input, **kwargs)
  File "/home/cc/.local/lib/python3.6/site-packages/dgl/nn/pytorch/conv/sageconv.py", line 258, in forward
    graph.update_all(msg_fn, self._lstm_reducer)
  File "/home/cc/.local/lib/python3.6/site-packages/dgl/heterograph.py", line 4849, in update_all
    ndata = core.message_passing(g, message_func, reduce_func, apply_node_func)
  File "/home/cc/.local/lib/python3.6/site-packages/dgl/core.py", line 337, in message_passing
    ndata = invoke_udf_reduce(g, rfunc, msgdata, orig_nid=orig_nid)
  File "/home/cc/.local/lib/python3.6/site-packages/dgl/core.py", line 143, in invoke_udf_reduce
    bkt_rsts.append(func(nbatch))
  File "/home/cc/.local/lib/python3.6/site-packages/dgl/nn/pytorch/conv/sageconv.py", line 173, in _lstm_reducer
    _, (rst, _) = self.lstm(m, h)
  File "/home/cc/.local/lib/python3.6/site-packages/torch/nn/modules/module.py", line 727, in _call_impl
    result = self.forward(*input, **kwargs)
  File "/home/cc/.local/lib/python3.6/site-packages/torch/nn/modules/rnn.py", line 582, in forward
    self.dropout, self.training, self.bidirectional, self.batch_first)
RuntimeError: CUDA out of memory. Tried to allocate 46.00 MiB (GPU 0; 23.62 GiB total capacity; 20.86 GiB already allocated; 13.44 MiB free; 21.02 GiB reserved in total by PyTorch)
