main start at this time 1648303343.8645115
#nodes: 2449029
#edges: 123718024
#classes: 47
success----------------------------------------
196571
39255
2164782
# Nodes: 2400608
# Edges: 123718024
# Train: 196571
# Val: 39255
# Test: 2164782
# Classes: 47

in feats:  100
----------------------------------------before generate_dataloader_block 
 Nvidia-smi: 2.0242919921875 GB
    Memory Allocated: 0.0006527900695800781  GigaBytes
Max Memory Allocated: 0.0006527900695800781  GigaBytes

The real block id is  2
get_global_graph_edges_ids_block function  spend 0.613250732421875
range selection method range initialization spend 0.02851271629333496
time for parepare:  0.36445021629333496
local_output_nid generation:  0.003536701202392578
local_in_edges_tensor generation:  0.03125262260437012
mini_batch_src_global generation:  0.024621009826660156
r_  generation:  0.35315728187561035
local_output_nid generation:  0.0037453174591064453
local_in_edges_tensor generation:  0.013873815536499023
mini_batch_src_global generation:  0.032380104064941406
r_  generation:  0.4073634147644043
local_output_nid generation:  0.0037276744842529297
local_in_edges_tensor generation:  0.006762504577636719
mini_batch_src_global generation:  0.027497529983520508
r_  generation:  0.4242134094238281
local_output_nid generation:  0.003788471221923828
local_in_edges_tensor generation:  0.006384372711181641
mini_batch_src_global generation:  0.026305675506591797
r_  generation:  0.4457871913909912
local_output_nid generation:  0.003679037094116211
local_in_edges_tensor generation:  0.005196332931518555
mini_batch_src_global generation:  0.0280611515045166
r_  generation:  0.4758944511413574
local_output_nid generation:  0.003742218017578125
local_in_edges_tensor generation:  0.005438804626464844
mini_batch_src_global generation:  0.030810117721557617
r_  generation:  0.48251962661743164
local_output_nid generation:  0.003690004348754883
local_in_edges_tensor generation:  0.005105733871459961
mini_batch_src_global generation:  0.03338146209716797
r_  generation:  0.5007972717285156
local_output_nid generation:  0.003713369369506836
local_in_edges_tensor generation:  0.005340099334716797
mini_batch_src_global generation:  0.033147573471069336
r_  generation:  0.5046894550323486
local_output_nid generation:  0.0037212371826171875
local_in_edges_tensor generation:  0.005555391311645508
mini_batch_src_global generation:  0.034590721130371094
r_  generation:  0.5019927024841309
local_output_nid generation:  0.0037038326263427734
local_in_edges_tensor generation:  0.005304574966430664
mini_batch_src_global generation:  0.03595137596130371
r_  generation:  0.5105822086334229
local_output_nid generation:  0.0037038326263427734
local_in_edges_tensor generation:  0.005456447601318359
mini_batch_src_global generation:  0.039626121520996094
r_  generation:  0.519603967666626
local_output_nid generation:  0.0036649703979492188
local_in_edges_tensor generation:  0.005331277847290039
mini_batch_src_global generation:  0.03868842124938965
r_  generation:  0.5129725933074951
local_output_nid generation:  0.0036842823028564453
local_in_edges_tensor generation:  0.005340576171875
mini_batch_src_global generation:  0.0393824577331543
r_  generation:  0.5273895263671875
local_output_nid generation:  0.0036575794219970703
local_in_edges_tensor generation:  0.005721330642700195
mini_batch_src_global generation:  0.041159629821777344
r_  generation:  0.5217320919036865
local_output_nid generation:  0.0036754608154296875
local_in_edges_tensor generation:  0.005354166030883789
mini_batch_src_global generation:  0.041079044342041016
r_  generation:  0.5239818096160889
local_output_nid generation:  0.0036296844482421875
local_in_edges_tensor generation:  0.005305767059326172
mini_batch_src_global generation:  0.041367530822753906
r_  generation:  0.5261895656585693
----------------------check_connections_block total spend ----------------------------- 10.135934591293335
generate_one_block  5.591308832168579
generate_one_block  0.5018043518066406
generate_one_block  0.5204238891601562
generate_one_block  0.5022308826446533
generate_one_block  0.5014185905456543
generate_one_block  0.4993276596069336
generate_one_block  0.5102570056915283
generate_one_block  0.49698877334594727
generate_one_block  0.4974193572998047
generate_one_block  0.5045614242553711
generate_one_block  0.5136165618896484
generate_one_block  0.5045750141143799
generate_one_block  0.5001857280731201
generate_one_block  0.502173662185669
generate_one_block  0.49842143058776855
generate_one_block  0.5022566318511963
The real block id is  1
get_global_graph_edges_ids_block function  spend 3.605954170227051
gen group dst list time:  0.23334503173828125
time for parepare:  0.4638087749481201
local_output_nid generation:  0.09984517097473145
local_in_edges_tensor generation:  0.6671910285949707
mini_batch_src_global generation:  0.8681371212005615
r_  generation:  10.102552890777588
local_output_nid generation:  0.14380788803100586
local_in_edges_tensor generation:  0.5859053134918213
mini_batch_src_global generation:  1.0923504829406738
r_  generation:  10.486965656280518
local_output_nid generation:  0.15303468704223633
local_in_edges_tensor generation:  0.6261563301086426
mini_batch_src_global generation:  1.162825584411621
r_  generation:  10.436359643936157
local_output_nid generation:  0.15752911567687988
local_in_edges_tensor generation:  0.7188363075256348
mini_batch_src_global generation:  1.104081392288208
r_  generation:  10.61045527458191
local_output_nid generation:  0.18308568000793457
local_in_edges_tensor generation:  0.740347146987915
mini_batch_src_global generation:  1.1110508441925049
r_  generation:  10.734737396240234
local_output_nid generation:  0.1695725917816162
local_in_edges_tensor generation:  0.6630406379699707
mini_batch_src_global generation:  1.238034963607788
r_  generation:  11.362820625305176
local_output_nid generation:  0.19892120361328125
local_in_edges_tensor generation:  1.1340670585632324
mini_batch_src_global generation:  1.2541592121124268
r_  generation:  11.03700065612793
local_output_nid generation:  0.19613122940063477
local_in_edges_tensor generation:  0.8096294403076172
mini_batch_src_global generation:  1.2062337398529053
r_  generation:  10.900334596633911
local_output_nid generation:  0.19782781600952148
local_in_edges_tensor generation:  0.853024959564209
mini_batch_src_global generation:  1.1415562629699707
r_  generation:  10.971161842346191
local_output_nid generation:  0.17798757553100586
local_in_edges_tensor generation:  0.665337324142456
mini_batch_src_global generation:  1.1676230430603027
r_  generation:  10.957252740859985
local_output_nid generation:  0.203108549118042
local_in_edges_tensor generation:  0.8483016490936279
mini_batch_src_global generation:  1.1412379741668701
r_  generation:  11.051047801971436
local_output_nid generation:  0.17363190650939941
local_in_edges_tensor generation:  0.768477201461792
mini_batch_src_global generation:  1.1616921424865723
r_  generation:  10.862147092819214
local_output_nid generation:  0.20273780822753906
local_in_edges_tensor generation:  0.762725830078125
mini_batch_src_global generation:  1.463876724243164
r_  generation:  12.543333530426025
local_output_nid generation:  0.21918916702270508
local_in_edges_tensor generation:  0.8929266929626465
mini_batch_src_global generation:  1.2427780628204346
r_  generation:  10.960561275482178
local_output_nid generation:  0.20645403861999512
local_in_edges_tensor generation:  0.7704379558563232
mini_batch_src_global generation:  1.2899911403656006
r_  generation:  10.964508533477783
local_output_nid generation:  0.20745110511779785
local_in_edges_tensor generation:  0.8702297210693359
mini_batch_src_global generation:  1.1572816371917725
r_  generation:  11.054484367370605
----------------------check_connections_block total spend ----------------------------- 238.71426343917847
generate_one_block  15.858632802963257
generate_one_block  15.18162226676941
generate_one_block  15.134514808654785
generate_one_block  14.683521747589111
generate_one_block  15.162195444107056
generate_one_block  15.186349630355835Using backend: pytorch

generate_one_block  14.736418962478638
generate_one_block  15.189627647399902
generate_one_block  15.4444899559021
generate_one_block  14.846761465072632
generate_one_block  15.131380796432495
generate_one_block  15.217634677886963
generate_one_block  14.98258376121521
generate_one_block  14.813428163528442
generate_one_block  15.26988697052002
generate_one_block  15.227277994155884
The real block id is  0
get_global_graph_edges_ids_block function  spend 3.2469322681427
gen group dst list time:  1.107753038406372
time for parepare:  0.47844696044921875
local_output_nid generation:  0.5174663066864014
local_in_edges_tensor generation:  1.684748649597168
mini_batch_src_global generation:  1.9732542037963867
r_  generation:  23.78695797920227
local_output_nid generation:  0.6296432018280029
local_in_edges_tensor generation:  1.790302038192749
mini_batch_src_global generation:  2.5956473350524902
r_  generation:  23.95885920524597
local_output_nid generation:  0.642106294631958
local_in_edges_tensor generation:  1.7436096668243408
mini_batch_src_global generation:  2.79182767868042
r_  generation:  23.907588481903076
local_output_nid generation:  0.6510677337646484
local_in_edges_tensor generation:  1.7660489082336426
mini_batch_src_global generation:  2.811771869659424
r_  generation:  24.133880853652954
local_output_nid generation:  0.6649942398071289
local_in_edges_tensor generation:  1.7761261463165283
mini_batch_src_global generation:  2.538365125656128
r_  generation:  24.376962423324585
local_output_nid generation:  0.6681487560272217
local_in_edges_tensor generation:  3.29966139793396
mini_batch_src_global generation:  2.6634018421173096
r_  generation:  24.241477727890015
local_output_nid generation:  0.6700432300567627
local_in_edges_tensor generation:  1.8238754272460938
mini_batch_src_global generation:  2.6068384647369385
r_  generation:  24.37852144241333
local_output_nid generation:  0.6872138977050781
local_in_edges_tensor generation:  1.8184874057769775
mini_batch_src_global generation:  2.649296998977661
r_  generation:  24.235997676849365
local_output_nid generation:  0.6834406852722168
local_in_edges_tensor generation:  1.821239948272705
mini_batch_src_global generation:  2.642055034637451
r_  generation:  24.39479374885559
local_output_nid generation:  0.6946163177490234
local_in_edges_tensor generation:  1.821857213973999
mini_batch_src_global generation:  2.6685471534729004
r_  generation:  24.36284899711609
local_output_nid generation:  0.6860761642456055
local_in_edges_tensor generation:  1.8267021179199219
mini_batch_src_global generation:  2.620870351791382
r_  generation:  24.646073579788208
local_output_nid generation:  0.6914386749267578
local_in_edges_tensor generation:  1.8101179599761963
mini_batch_src_global generation:  2.7213144302368164
r_  generation:  24.29762887954712
local_output_nid generation:  0.7003800868988037
local_in_edges_tensor generation:  1.8235325813293457
mini_batch_src_global generation:  2.590284824371338
r_  generation:  24.50078797340393
local_output_nid generation:  0.7040843963623047
local_in_edges_tensor generation:  1.8290965557098389
mini_batch_src_global generation:  2.6758358478546143
r_  generation:  24.421005249023438
local_output_nid generation:  0.6856722831726074
local_in_edges_tensor generation:  1.8151297569274902
mini_batch_src_global generation:  2.5974249839782715
r_  generation:  24.811364889144897
local_output_nid generation:  0.6860256195068359
local_in_edges_tensor generation:  1.8139405250549316
mini_batch_src_global generation:  2.7532522678375244
r_  generation:  24.370285987854004
----------------------check_connections_block total spend ----------------------------- 542.0214247703552
generate_one_block  33.42456007003784
generate_one_block  33.39381432533264
generate_one_block  33.03547143936157
generate_one_block  32.94174003601074
generate_one_block  33.00807237625122
generate_one_block  33.21753644943237
generate_one_block  34.24587035179138
generate_one_block  33.29144859313965
generate_one_block  33.31941843032837
generate_one_block  33.42270255088806
generate_one_block  33.416512966156006
generate_one_block  33.1894154548645
generate_one_block  33.27458596229553
generate_one_block  33.516157150268555
generate_one_block  33.24096417427063
generate_one_block  33.80842041969299
-----------------------------------------after block dataloader generation 
 Nvidia-smi: 2.0242919921875 GB
    Memory Allocated: 0.0006527900695800781  GigaBytes
Max Memory Allocated: 0.0006527900695800781  GigaBytes

connection checking time:  780.7356882095337
block generation total time  775.8130178451538
average batch blocks generation time:  48.48831361532211
----------------------------------------before batch_pred = model(blocks, batch_inputs) 
 Nvidia-smi: 3.6239013671875 GB
    Memory Allocated: 1.5185651779174805  GigaBytes
Max Memory Allocated: 1.5185651779174805  GigaBytes

Traceback (most recent call last):
  File "pseudo_mini_batch_range_products_sage.py", line 455, in <module>
    main()
  File "pseudo_mini_batch_range_products_sage.py", line 451, in main
    best_test = run(args, device, data)
  File "pseudo_mini_batch_range_products_sage.py", line 276, in run
    batch_pred = model(blocks, batch_inputs)#------------*
  File "/home/cc/.local/lib/python3.6/site-packages/torch/nn/modules/module.py", line 727, in _call_impl
    result = self.forward(*input, **kwargs)
  File "/home/cc/graph_partition_multi_layers/pseudo_mini_batch_full_batch/SAGE/graphsage_model_products.py", line 48, in forward
    x = layer(block, x)
  File "/home/cc/.local/lib/python3.6/site-packages/torch/nn/modules/module.py", line 727, in _call_impl
    result = self.forward(*input, **kwargs)
  File "/home/cc/.local/lib/python3.6/site-packages/dgl/nn/pytorch/conv/sageconv.py", line 258, in forward
    graph.update_all(msg_fn, self._lstm_reducer)
  File "/home/cc/.local/lib/python3.6/site-packages/dgl/heterograph.py", line 4849, in update_all
    ndata = core.message_passing(g, message_func, reduce_func, apply_node_func)
  File "/home/cc/.local/lib/python3.6/site-packages/dgl/core.py", line 327, in message_passing
    msgdata = invoke_gsddmm(g, mfunc)
  File "/home/cc/.local/lib/python3.6/site-packages/dgl/core.py", line 245, in invoke_gsddmm
    z = op(graph, x)
  File "/home/cc/.local/lib/python3.6/site-packages/dgl/ops/sddmm.py", line 169, in copy_u
    return gsddmm(g, 'copy_lhs', x, None)
  File "/home/cc/.local/lib/python3.6/site-packages/dgl/ops/sddmm.py", line 75, in gsddmm
    g._graph, op, lhs_data, rhs_data, lhs_target, rhs_target)
  File "/home/cc/.local/lib/python3.6/site-packages/dgl/backend/pytorch/sparse.py", line 512, in gsddmm
    return GSDDMM.apply(gidx, op, lhs_data, rhs_data, lhs_target, rhs_target)
  File "/home/cc/.local/lib/python3.6/site-packages/torch/cuda/amp/autocast_mode.py", line 213, in decorate_fwd
    return fwd(*args, **kwargs)
  File "/home/cc/.local/lib/python3.6/site-packages/dgl/backend/pytorch/sparse.py", line 256, in forward
    out = _gsddmm(gidx, op, X, Y, lhs_target, rhs_target)
  File "/home/cc/.local/lib/python3.6/site-packages/dgl/sparse.py", line 328, in _gsddmm
    out = F.zeros(out_shp, dtype, ctx)
  File "/home/cc/.local/lib/python3.6/site-packages/dgl/backend/pytorch/tensor.py", line 220, in zeros
    return th.zeros(shape, dtype=dtype, device=ctx)
RuntimeError: CUDA out of memory. Tried to allocate 22.94 GiB (GPU 0; 23.62 GiB total capacity; 1.52 GiB already allocated; 20.00 GiB free; 1.54 GiB reserved in total by PyTorch)
