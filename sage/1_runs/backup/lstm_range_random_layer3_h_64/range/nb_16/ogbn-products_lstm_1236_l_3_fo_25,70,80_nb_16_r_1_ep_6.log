main start at this time 1648283428.0899434
#nodes: 2449029
#edges: 123718024
#classes: 47
success----------------------------------------
196571
39255
2164782
# Nodes: 2400608
# Edges: 123718024
# Train: 196571
# Val: 39255
# Test: 2164782
# Classes: 47

in feats:  100
----------------------------------------before generate_dataloader_block 
 Nvidia-smi: 2.0242919921875 GB
    Memory Allocated: 0.0006527900695800781  GigaBytes
Max Memory Allocated: 0.0006527900695800781  GigaBytes

The real block id is  2
get_global_graph_edges_ids_block function  spend 0.6322345733642578
range selection method range initialization spend 0.028495311737060547
time for parepare:  0.36756420135498047
local_output_nid generation:  0.003538846969604492
local_in_edges_tensor generation:  0.03986477851867676
mini_batch_src_global generation:  0.028094768524169922
r_  generation:  0.3609433174133301
local_output_nid generation:  0.003984689712524414
local_in_edges_tensor generation:  0.014419317245483398
mini_batch_src_global generation:  0.03565621376037598
r_  generation:  0.4073212146759033
local_output_nid generation:  0.003908634185791016
local_in_edges_tensor generation:  0.005166530609130859
mini_batch_src_global generation:  0.025838851928710938
r_  generation:  0.4305591583251953
local_output_nid generation:  0.0038886070251464844
local_in_edges_tensor generation:  0.009589195251464844
mini_batch_src_global generation:  0.029747724533081055
r_  generation:  0.44899439811706543
local_output_nid generation:  0.0036449432373046875
local_in_edges_tensor generation:  0.005121469497680664
mini_batch_src_global generation:  0.027562379837036133
r_  generation:  0.47801685333251953
local_output_nid generation:  0.0038862228393554688
local_in_edges_tensor generation:  0.005911350250244141
mini_batch_src_global generation:  0.030450105667114258
r_  generation:  0.4862096309661865
local_output_nid generation:  0.0038726329803466797
local_in_edges_tensor generation:  0.00527501106262207
mini_batch_src_global generation:  0.03254246711730957
r_  generation:  0.5054824352264404
local_output_nid generation:  0.003710508346557617
local_in_edges_tensor generation:  0.005079507827758789
mini_batch_src_global generation:  0.032947540283203125
r_  generation:  0.507544755935669
local_output_nid generation:  0.0036759376525878906
local_in_edges_tensor generation:  0.00508880615234375
mini_batch_src_global generation:  0.03420138359069824
r_  generation:  0.503363847732544
local_output_nid generation:  0.003691434860229492
local_in_edges_tensor generation:  0.005035877227783203
mini_batch_src_global generation:  0.035631656646728516
r_  generation:  0.51133131980896
local_output_nid generation:  0.003662109375
local_in_edges_tensor generation:  0.005133152008056641
mini_batch_src_global generation:  0.05624675750732422
r_  generation:  0.5618634223937988
local_output_nid generation:  0.0037178993225097656
local_in_edges_tensor generation:  0.0053937435150146484
mini_batch_src_global generation:  0.03892970085144043
r_  generation:  0.5249786376953125
local_output_nid generation:  0.003694295883178711
local_in_edges_tensor generation:  0.005129814147949219
mini_batch_src_global generation:  0.03925132751464844
r_  generation:  0.5402936935424805
local_output_nid generation:  0.003709077835083008
local_in_edges_tensor generation:  0.0062122344970703125
mini_batch_src_global generation:  0.04051852226257324
r_  generation:  0.5380687713623047
local_output_nid generation:  0.003689289093017578
local_in_edges_tensor generation:  0.00729823112487793
mini_batch_src_global generation:  0.04148459434509277
r_  generation:  0.5543575286865234
local_output_nid generation:  0.0038776397705078125
local_in_edges_tensor generation:  0.007898569107055664
mini_batch_src_global generation:  0.042057037353515625
r_  generation:  0.5480623245239258
----------------------check_connections_block total spend ----------------------------- 10.418216705322266
generate_one_block  6.550348281860352
generate_one_block  0.49727439880371094
generate_one_block  0.5321495532989502
generate_one_block  0.5055649280548096
generate_one_block  0.5110867023468018
generate_one_block  0.5151584148406982
generate_one_block  0.5655941963195801
generate_one_block  0.5587477684020996
generate_one_block  0.5964617729187012
generate_one_block  0.5716750621795654
generate_one_block  0.5711944103240967
generate_one_block  0.5825095176696777
generate_one_block  0.5150284767150879
generate_one_block  0.5208549499511719
generate_one_block  0.5068559646606445
generate_one_block  0.5179347991943359
The real block id is  1
get_global_graph_edges_ids_block function  spend 3.472438335418701
gen group dst list time:  0.25530242919921875
time for parepare:  0.47496962547302246
local_output_nid generation:  0.11016535758972168
local_in_edges_tensor generation:  0.6989407539367676
mini_batch_src_global generation:  0.8973538875579834
r_  generation:  10.563871383666992
local_output_nid generation:  0.16350555419921875
local_in_edges_tensor generation:  0.7318055629730225
mini_batch_src_global generation:  1.226374864578247
r_  generation:  10.42740535736084
local_output_nid generation:  0.1699981689453125
local_in_edges_tensor generation:  0.8437285423278809
mini_batch_src_global generation:  1.1469895839691162
r_  generation:  10.65931749343872
local_output_nid generation:  0.16569948196411133
local_in_edges_tensor generation:  0.8450968265533447
mini_batch_src_global generation:  1.1337308883666992
r_  generation:  10.722261428833008
local_output_nid generation:  0.17330074310302734
local_in_edges_tensor generation:  0.6418867111206055
mini_batch_src_global generation:  1.1734273433685303
r_  generation:  10.777516841888428
local_output_nid generation:  0.18926501274108887
local_in_edges_tensor generation:  0.8065192699432373
mini_batch_src_global generation:  1.1263794898986816
r_  generation:  10.895517826080322
local_output_nid generation:  0.16864728927612305
local_in_edges_tensor generation:  0.6606347560882568
mini_batch_src_global generation:  1.1793885231018066
r_  generation:  10.72665786743164
local_output_nid generation:  0.19979572296142578
local_in_edges_tensor generation:  0.8261001110076904
mini_batch_src_global generation:  1.182234764099121
r_  generation:  10.994374513626099
local_output_nid generation:  0.1707160472869873
local_in_edges_tensor generation:  0.7035305500030518
mini_batch_src_global generation:  1.137420892715454
r_  generation:  10.676383972167969
local_output_nid generation:  0.19829821586608887
local_in_edges_tensor generation:  0.7911999225616455
mini_batch_src_global generation:  1.1785085201263428
r_  generation:  10.926158666610718
local_output_nid generation:  0.18390297889709473
local_in_edges_tensor generation:  0.8452563285827637
mini_batch_src_global generation:  1.1677534580230713
r_  generation:  10.822691202163696
local_output_nid generation:  0.18291521072387695
local_in_edges_tensor generation:  0.663754940032959
mini_batch_src_global generation:  1.2310400009155273
r_  generation:  10.802220106124878
local_output_nid generation:  0.20952081680297852
local_in_edges_tensor generation:  0.837287425994873
mini_batch_src_global generation:  1.1427857875823975
r_  generation:  10.901248931884766
local_output_nid generation:  0.17774009704589844
local_in_edges_tensor generation:  0.6665148735046387
mini_batch_src_global generation:  1.1654558181762695
r_  generation:  10.823609828948975
local_output_nid generation:  0.20846772193908691
local_in_edges_tensor generation:  0.8390274047851562
mini_batch_src_global generation:  1.141127109527588
r_  generation:  10.890407085418701
local_output_nid generation:  0.17534732818603516
local_in_edges_tensor generation:  0.6738331317901611
mini_batch_src_global generation:  1.2315657138824463
r_  generation:  10.75378942489624
----------------------check_connections_block total spend ----------------------------- 235.0034818649292
generate_one_block  15.908198118209839
generate_one_block  15.131818771362305
generate_one_block  14.963204860687256
generate_one_block  14.771297454833984
generate_one_block  15.129464864730835
generate_one_block  14.704720497131348Using backend: pytorch

generate_one_block  15.06604814529419
generate_one_block  15.136462211608887
generate_one_block  14.932118892669678
generate_one_block  15.1458101272583
generate_one_block  15.15883183479309
generate_one_block  14.671890258789062
generate_one_block  15.067933797836304
generate_one_block  15.14858603477478
generate_one_block  14.681937217712402
generate_one_block  15.19769287109375
The real block id is  0
get_global_graph_edges_ids_block function  spend 2.135077714920044
gen group dst list time:  1.040982723236084
time for parepare:  0.466109037399292
local_output_nid generation:  0.49622488021850586
local_in_edges_tensor generation:  1.1750037670135498
mini_batch_src_global generation:  1.1528282165527344
r_  generation:  15.193104267120361
local_output_nid generation:  0.5511252880096436
local_in_edges_tensor generation:  1.1838831901550293
mini_batch_src_global generation:  1.5446200370788574
r_  generation:  15.326304912567139
local_output_nid generation:  0.6297929286956787
local_in_edges_tensor generation:  1.2068071365356445
mini_batch_src_global generation:  1.5312693119049072
r_  generation:  15.833579540252686
local_output_nid generation:  0.6473770141601562
local_in_edges_tensor generation:  1.3447849750518799
mini_batch_src_global generation:  1.6444549560546875
r_  generation:  16.23675799369812
local_output_nid generation:  0.6469686031341553
local_in_edges_tensor generation:  1.2831885814666748
mini_batch_src_global generation:  1.722364902496338
r_  generation:  16.054938554763794
local_output_nid generation:  0.6431386470794678
local_in_edges_tensor generation:  2.579481363296509
mini_batch_src_global generation:  1.5703778266906738
r_  generation:  15.791304111480713
local_output_nid generation:  0.6564490795135498
local_in_edges_tensor generation:  1.2902717590332031
mini_batch_src_global generation:  1.6799991130828857
r_  generation:  16.13262128829956
local_output_nid generation:  0.6635375022888184
local_in_edges_tensor generation:  1.3019654750823975
mini_batch_src_global generation:  1.6390330791473389
r_  generation:  15.844805717468262
local_output_nid generation:  0.6579725742340088
local_in_edges_tensor generation:  1.2993621826171875
mini_batch_src_global generation:  1.6873178482055664
r_  generation:  16.205225944519043
local_output_nid generation:  0.6676218509674072
local_in_edges_tensor generation:  1.3130223751068115
mini_batch_src_global generation:  1.672576665878296
r_  generation:  15.898560762405396
local_output_nid generation:  0.6613457202911377
local_in_edges_tensor generation:  1.3008029460906982
mini_batch_src_global generation:  1.7055201530456543
r_  generation:  16.32934880256653
local_output_nid generation:  0.6676623821258545
local_in_edges_tensor generation:  1.3092968463897705
mini_batch_src_global generation:  1.662501335144043
r_  generation:  15.865811586380005
local_output_nid generation:  0.6529595851898193
local_in_edges_tensor generation:  1.3072621822357178
mini_batch_src_global generation:  1.6855218410491943
r_  generation:  16.172041654586792
local_output_nid generation:  0.6747922897338867
local_in_edges_tensor generation:  1.3005948066711426
mini_batch_src_global generation:  1.721020221710205
r_  generation:  16.03393316268921
local_output_nid generation:  0.6625018119812012
local_in_edges_tensor generation:  1.3328495025634766
mini_batch_src_global generation:  1.7185885906219482
r_  generation:  16.42352294921875
local_output_nid generation:  0.6393330097198486
local_in_edges_tensor generation:  1.3229050636291504
mini_batch_src_global generation:  1.6982574462890625
r_  generation:  16.028611660003662
----------------------check_connections_block total spend ----------------------------- 361.3747556209564
generate_one_block  21.479671955108643
generate_one_block  21.43215322494507
generate_one_block  21.31273126602173
generate_one_block  21.38701367378235
generate_one_block  21.332486867904663
generate_one_block  21.054636001586914
generate_one_block  22.291566371917725
generate_one_block  21.338985204696655
generate_one_block  21.352604627609253
generate_one_block  21.41547393798828
generate_one_block  21.247836589813232
generate_one_block  21.533846139907837
generate_one_block  21.355565071105957
generate_one_block  21.68410015106201
generate_one_block  21.358071327209473
generate_one_block  21.690319776535034
-----------------------------------------after block dataloader generation 
 Nvidia-smi: 2.0242919921875 GB
    Memory Allocated: 0.0006527900695800781  GigaBytes
Max Memory Allocated: 0.0006527900695800781  GigaBytes

connection checking time:  596.3782374858856
block generation total time  584.0830781459808
average batch blocks generation time:  36.5051923841238
----------------------------------------before batch_pred = model(blocks, batch_inputs) 
 Nvidia-smi: 3.4305419921875 GB
    Memory Allocated: 1.3293285369873047  GigaBytes
Max Memory Allocated: 1.3293285369873047  GigaBytes

Traceback (most recent call last):
  File "pseudo_mini_batch_range_products_sage.py", line 455, in <module>
    main()
  File "pseudo_mini_batch_range_products_sage.py", line 451, in main
    best_test = run(args, device, data)
  File "pseudo_mini_batch_range_products_sage.py", line 276, in run
    batch_pred = model(blocks, batch_inputs)#------------*
  File "/home/cc/.local/lib/python3.6/site-packages/torch/nn/modules/module.py", line 727, in _call_impl
    result = self.forward(*input, **kwargs)
  File "/home/cc/graph_partition_multi_layers/pseudo_mini_batch_full_batch/SAGE/graphsage_model_products.py", line 48, in forward
    x = layer(block, x)
  File "/home/cc/.local/lib/python3.6/site-packages/torch/nn/modules/module.py", line 727, in _call_impl
    result = self.forward(*input, **kwargs)
  File "/home/cc/.local/lib/python3.6/site-packages/dgl/nn/pytorch/conv/sageconv.py", line 258, in forward
    graph.update_all(msg_fn, self._lstm_reducer)
  File "/home/cc/.local/lib/python3.6/site-packages/dgl/heterograph.py", line 4849, in update_all
    ndata = core.message_passing(g, message_func, reduce_func, apply_node_func)
  File "/home/cc/.local/lib/python3.6/site-packages/dgl/core.py", line 337, in message_passing
    ndata = invoke_udf_reduce(g, rfunc, msgdata, orig_nid=orig_nid)
  File "/home/cc/.local/lib/python3.6/site-packages/dgl/core.py", line 143, in invoke_udf_reduce
    bkt_rsts.append(func(nbatch))
  File "/home/cc/.local/lib/python3.6/site-packages/dgl/nn/pytorch/conv/sageconv.py", line 173, in _lstm_reducer
    _, (rst, _) = self.lstm(m, h)
  File "/home/cc/.local/lib/python3.6/site-packages/torch/nn/modules/module.py", line 727, in _call_impl
    result = self.forward(*input, **kwargs)
  File "/home/cc/.local/lib/python3.6/site-packages/torch/nn/modules/rnn.py", line 582, in forward
    self.dropout, self.training, self.bidirectional, self.batch_first)
RuntimeError: CUDA out of memory. Tried to allocate 58.00 MiB (GPU 0; 23.62 GiB total capacity; 20.80 GiB already allocated; 25.44 MiB free; 20.99 GiB reserved in total by PyTorch)
