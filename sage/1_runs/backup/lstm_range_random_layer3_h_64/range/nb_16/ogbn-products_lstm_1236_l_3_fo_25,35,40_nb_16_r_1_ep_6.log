main start at this time 1648255631.715287
#nodes: 2449029
#edges: 123718024
#classes: 47
success----------------------------------------
196571
39255
2164782
# Nodes: 2400608
# Edges: 123718024
# Train: 196571
# Val: 39255
# Test: 2164782
# Classes: 47

in feats:  100
----------------------------------------before generate_dataloader_block 
 Nvidia-smi: 2.0242919921875 GB
    Memory Allocated: 0.0006527900695800781  GigaBytes
Max Memory Allocated: 0.0006527900695800781  GigaBytes

The real block id is  2
get_global_graph_edges_ids_block function  spend 0.35616135597229004
range selection method range initialization spend 0.02924942970275879
time for parepare:  0.27703857421875
local_output_nid generation:  0.0031206607818603516
local_in_edges_tensor generation:  0.025219202041625977
mini_batch_src_global generation:  0.014073610305786133
r_  generation:  0.1822659969329834
local_output_nid generation:  0.0037474632263183594
local_in_edges_tensor generation:  0.003331899642944336
mini_batch_src_global generation:  0.018213748931884766
r_  generation:  0.2028970718383789
local_output_nid generation:  0.003693103790283203
local_in_edges_tensor generation:  0.0035409927368164062
mini_batch_src_global generation:  0.012298345565795898
r_  generation:  0.21523213386535645
local_output_nid generation:  0.003756284713745117
local_in_edges_tensor generation:  0.0035636425018310547
mini_batch_src_global generation:  0.013147592544555664
r_  generation:  0.2309551239013672
local_output_nid generation:  0.003951549530029297
local_in_edges_tensor generation:  0.0038232803344726562
mini_batch_src_global generation:  0.01644420623779297
r_  generation:  0.24108624458312988
local_output_nid generation:  0.004035234451293945
local_in_edges_tensor generation:  0.0036580562591552734
mini_batch_src_global generation:  0.02131795883178711
r_  generation:  0.2431328296661377
local_output_nid generation:  0.003711223602294922
local_in_edges_tensor generation:  0.003717660903930664
mini_batch_src_global generation:  0.016815900802612305
r_  generation:  0.2528066635131836
local_output_nid generation:  0.0037031173706054688
local_in_edges_tensor generation:  0.0040285587310791016
mini_batch_src_global generation:  0.01734137535095215
r_  generation:  0.259415864944458
local_output_nid generation:  0.0037577152252197266
local_in_edges_tensor generation:  0.0038635730743408203
mini_batch_src_global generation:  0.019809961318969727
r_  generation:  0.2622547149658203
local_output_nid generation:  0.003686189651489258
local_in_edges_tensor generation:  0.003632783889770508
mini_batch_src_global generation:  0.018453121185302734
r_  generation:  0.2607135772705078
local_output_nid generation:  0.0036993026733398438
local_in_edges_tensor generation:  0.0035521984100341797
mini_batch_src_global generation:  0.020516633987426758
r_  generation:  0.2715022563934326
local_output_nid generation:  0.0037767887115478516
local_in_edges_tensor generation:  0.0035893917083740234
mini_batch_src_global generation:  0.020091772079467773
r_  generation:  0.2746105194091797
local_output_nid generation:  0.0037086009979248047
local_in_edges_tensor generation:  0.0036003589630126953
mini_batch_src_global generation:  0.020434141159057617
r_  generation:  0.2691502571105957
local_output_nid generation:  0.00372314453125
local_in_edges_tensor generation:  0.003427743911743164
mini_batch_src_global generation:  0.02029871940612793
r_  generation:  0.27376770973205566
local_output_nid generation:  0.0036911964416503906
local_in_edges_tensor generation:  0.003381013870239258
mini_batch_src_global generation:  0.020779132843017578
r_  generation:  0.2739090919494629
local_output_nid generation:  0.0036818981170654297
local_in_edges_tensor generation:  0.0034623146057128906
mini_batch_src_global generation:  0.021516799926757812
r_  generation:  0.269794225692749
----------------------check_connections_block total spend ----------------------------- 5.4351112842559814
generate_one_block  5.417441129684448
generate_one_block  0.2698333263397217
generate_one_block  0.28895115852355957
generate_one_block  0.31272077560424805
generate_one_block  0.2816746234893799
generate_one_block  0.27644848823547363
generate_one_block  0.27514219284057617
generate_one_block  0.27219390869140625
generate_one_block  0.27695155143737793
generate_one_block  0.31149864196777344
generate_one_block  0.28778505325317383
generate_one_block  0.2782406806945801
generate_one_block  0.2732205390930176
generate_one_block  0.27424001693725586
generate_one_block  0.2800595760345459
generate_one_block  0.30425071716308594
The real block id is  1
get_global_graph_edges_ids_block function  spend 2.1140518188476562
gen group dst list time:  0.1537930965423584
time for parepare:  0.44989538192749023
local_output_nid generation:  0.06831145286560059
local_in_edges_tensor generation:  0.4450397491455078
mini_batch_src_global generation:  0.343503475189209
r_  generation:  4.419995546340942
local_output_nid generation:  0.0894618034362793
local_in_edges_tensor generation:  0.241743803024292
mini_batch_src_global generation:  0.42510128021240234
r_  generation:  4.605329275131226
local_output_nid generation:  0.09232664108276367
local_in_edges_tensor generation:  0.2587134838104248
mini_batch_src_global generation:  0.41871213912963867
r_  generation:  4.758654832839966
local_output_nid generation:  0.1103200912475586
local_in_edges_tensor generation:  0.26854944229125977
mini_batch_src_global generation:  0.4295470714569092
r_  generation:  4.811045408248901
local_output_nid generation:  0.10409736633300781
local_in_edges_tensor generation:  0.27728748321533203
mini_batch_src_global generation:  0.44745445251464844
r_  generation:  4.957695722579956
local_output_nid generation:  0.10708022117614746
local_in_edges_tensor generation:  0.2853853702545166
mini_batch_src_global generation:  0.45842552185058594
r_  generation:  5.006548166275024
local_output_nid generation:  0.11023068428039551
local_in_edges_tensor generation:  0.3361504077911377
mini_batch_src_global generation:  0.46360230445861816
r_  generation:  4.945072650909424
local_output_nid generation:  0.1110692024230957
local_in_edges_tensor generation:  0.30145740509033203
mini_batch_src_global generation:  0.46254777908325195
r_  generation:  4.948944807052612
local_output_nid generation:  0.11111927032470703
local_in_edges_tensor generation:  0.29286718368530273
mini_batch_src_global generation:  0.47751760482788086
r_  generation:  5.062057733535767
local_output_nid generation:  0.13452434539794922
local_in_edges_tensor generation:  0.3485074043273926
mini_batch_src_global generation:  0.46927976608276367
r_  generation:  4.963390827178955
local_output_nid generation:  0.11726021766662598
local_in_edges_tensor generation:  0.30254197120666504
mini_batch_src_global generation:  0.4702610969543457
r_  generation:  5.034775972366333
local_output_nid generation:  0.11378645896911621
local_in_edges_tensor generation:  0.2973363399505615
mini_batch_src_global generation:  0.4814121723175049
r_  generation:  5.085352182388306
local_output_nid generation:  0.12138748168945312
local_in_edges_tensor generation:  0.5659408569335938
mini_batch_src_global generation:  0.4980275630950928
r_  generation:  4.977311134338379
local_output_nid generation:  0.12300801277160645
local_in_edges_tensor generation:  0.306276798248291
mini_batch_src_global generation:  0.4836008548736572
r_  generation:  5.0914857387542725
local_output_nid generation:  0.11476922035217285
local_in_edges_tensor generation:  0.3052043914794922
mini_batch_src_global generation:  0.4761641025543213
r_  generation:  5.051661252975464
local_output_nid generation:  0.1222224235534668
local_in_edges_tensor generation:  0.42156434059143066
mini_batch_src_global generation:  0.47884702682495117
r_  generation:  5.007457494735718
----------------------check_connections_block total spend ----------------------------- 106.56176614761353
generate_one_block  6.873697757720947
generate_one_block  6.118546485900879
generate_one_block  6.516481876373291
generate_one_block  6.083544492721558
generate_one_block  6.131447792053223
Using backend: pytorch
generate_one_block  6.098756790161133
generate_one_block  6.46475625038147
generate_one_block  6.196504592895508
generate_one_block  6.216453790664673
generate_one_block  6.113042116165161
generate_one_block  6.472155809402466
generate_one_block  6.156680107116699
generate_one_block  6.098236560821533
generate_one_block  6.118855714797974
generate_one_block  6.436233282089233
generate_one_block  6.1770336627960205
The real block id is  0
get_global_graph_edges_ids_block function  spend 2.257351875305176
gen group dst list time:  0.8449993133544922
time for parepare:  0.47609996795654297
local_output_nid generation:  0.4375953674316406
local_in_edges_tensor generation:  1.0550577640533447
mini_batch_src_global generation:  1.0202910900115967
r_  generation:  13.557723045349121
local_output_nid generation:  0.47643518447875977
local_in_edges_tensor generation:  1.0749657154083252
mini_batch_src_global generation:  1.2866575717926025
r_  generation:  13.789793491363525
local_output_nid generation:  0.5468518733978271
local_in_edges_tensor generation:  0.9803705215454102
mini_batch_src_global generation:  1.4377930164337158
r_  generation:  14.037508010864258
local_output_nid generation:  0.5197017192840576
local_in_edges_tensor generation:  1.1217520236968994
mini_batch_src_global generation:  1.3474154472351074
r_  generation:  14.114897966384888
local_output_nid generation:  0.5294482707977295
local_in_edges_tensor generation:  1.1451044082641602
mini_batch_src_global generation:  1.406339406967163
r_  generation:  14.177874326705933
local_output_nid generation:  0.5440974235534668
local_in_edges_tensor generation:  2.101902723312378
mini_batch_src_global generation:  1.3557562828063965
r_  generation:  14.105925559997559
local_output_nid generation:  0.5497896671295166
local_in_edges_tensor generation:  1.050513744354248
mini_batch_src_global generation:  1.4133832454681396
r_  generation:  14.29826807975769
local_output_nid generation:  0.5562906265258789
local_in_edges_tensor generation:  1.1188981533050537
mini_batch_src_global generation:  1.3212625980377197
r_  generation:  14.210285902023315
local_output_nid generation:  0.5321803092956543
local_in_edges_tensor generation:  1.0619335174560547
mini_batch_src_global generation:  1.3921639919281006
r_  generation:  14.10697054862976
local_output_nid generation:  0.5652754306793213
local_in_edges_tensor generation:  1.1079304218292236
mini_batch_src_global generation:  1.3717498779296875
r_  generation:  14.128713130950928
local_output_nid generation:  0.5645368099212646
local_in_edges_tensor generation:  1.0907995700836182
mini_batch_src_global generation:  1.518495798110962
r_  generation:  15.005186080932617
local_output_nid generation:  0.5750806331634521
local_in_edges_tensor generation:  1.1496500968933105
mini_batch_src_global generation:  1.4923179149627686
r_  generation:  14.279487609863281
local_output_nid generation:  0.5718202590942383
local_in_edges_tensor generation:  1.0847456455230713
mini_batch_src_global generation:  1.4219861030578613
r_  generation:  14.36011004447937
local_output_nid generation:  0.5733640193939209
local_in_edges_tensor generation:  1.1543679237365723
mini_batch_src_global generation:  1.3939204216003418
r_  generation:  14.532485485076904
local_output_nid generation:  0.5389113426208496
local_in_edges_tensor generation:  1.1526813507080078
mini_batch_src_global generation:  1.34773850440979
r_  generation:  14.295223712921143
local_output_nid generation:  0.5411534309387207
local_in_edges_tensor generation:  1.0880942344665527
mini_batch_src_global generation:  1.4279143810272217
r_  generation:  14.34104585647583
----------------------check_connections_block total spend ----------------------------- 317.5038299560547
generate_one_block  19.11461901664734
generate_one_block  19.128092288970947
generate_one_block  19.680368661880493
generate_one_block  19.144849061965942
generate_one_block  18.88127565383911
generate_one_block  19.000665426254272
generate_one_block  19.819414138793945
generate_one_block  19.18718695640564
generate_one_block  19.133850812911987
generate_one_block  18.815502643585205
generate_one_block  19.299671173095703
generate_one_block  19.031940460205078
generate_one_block  18.97724938392639
generate_one_block  19.082782745361328
generate_one_block  18.919775247573853
generate_one_block  19.300909757614136
-----------------------------------------after block dataloader generation 
 Nvidia-smi: 2.0242919921875 GB
    Memory Allocated: 0.0006527900695800781  GigaBytes
Max Memory Allocated: 0.0006527900695800781  GigaBytes

connection checking time:  424.0655961036682
block generation total time  406.79058051109314
average batch blocks generation time:  25.42441128194332
----------------------------------------before batch_pred = model(blocks, batch_inputs) 
 Nvidia-smi: 3.2332763671875 GB
    Memory Allocated: 1.1259174346923828  GigaBytes
Max Memory Allocated: 1.1259174346923828  GigaBytes

Traceback (most recent call last):
  File "pseudo_mini_batch_range_products_sage.py", line 455, in <module>
    main()
  File "pseudo_mini_batch_range_products_sage.py", line 451, in main
    best_test = run(args, device, data)
  File "pseudo_mini_batch_range_products_sage.py", line 276, in run
    batch_pred = model(blocks, batch_inputs)#------------*
  File "/home/cc/.local/lib/python3.6/site-packages/torch/nn/modules/module.py", line 727, in _call_impl
    result = self.forward(*input, **kwargs)
  File "/home/cc/graph_partition_multi_layers/pseudo_mini_batch_full_batch/SAGE/graphsage_model_products.py", line 48, in forward
    x = layer(block, x)
  File "/home/cc/.local/lib/python3.6/site-packages/torch/nn/modules/module.py", line 727, in _call_impl
    result = self.forward(*input, **kwargs)
  File "/home/cc/.local/lib/python3.6/site-packages/dgl/nn/pytorch/conv/sageconv.py", line 258, in forward
    graph.update_all(msg_fn, self._lstm_reducer)
  File "/home/cc/.local/lib/python3.6/site-packages/dgl/heterograph.py", line 4849, in update_all
    ndata = core.message_passing(g, message_func, reduce_func, apply_node_func)
  File "/home/cc/.local/lib/python3.6/site-packages/dgl/core.py", line 337, in message_passing
    ndata = invoke_udf_reduce(g, rfunc, msgdata, orig_nid=orig_nid)
  File "/home/cc/.local/lib/python3.6/site-packages/dgl/core.py", line 143, in invoke_udf_reduce
    bkt_rsts.append(func(nbatch))
  File "/home/cc/.local/lib/python3.6/site-packages/dgl/nn/pytorch/conv/sageconv.py", line 173, in _lstm_reducer
    _, (rst, _) = self.lstm(m, h)
  File "/home/cc/.local/lib/python3.6/site-packages/torch/nn/modules/module.py", line 727, in _call_impl
    result = self.forward(*input, **kwargs)
  File "/home/cc/.local/lib/python3.6/site-packages/torch/nn/modules/rnn.py", line 582, in forward
    self.dropout, self.training, self.bidirectional, self.batch_first)
RuntimeError: CUDA out of memory. Tried to allocate 36.00 MiB (GPU 0; 23.62 GiB total capacity; 20.71 GiB already allocated; 21.44 MiB free; 21.04 GiB reserved in total by PyTorch)
