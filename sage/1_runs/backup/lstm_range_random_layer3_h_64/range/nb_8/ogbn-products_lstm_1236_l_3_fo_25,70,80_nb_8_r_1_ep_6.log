Using backend: pytorch
main start at this time 1648282608.6899917
#nodes: 2449029
#edges: 123718024
#classes: 47
success----------------------------------------
196571
39255
2164782
# Nodes: 2400608
# Edges: 123718024
# Train: 196571
# Val: 39255
# Test: 2164782
# Classes: 47

in feats:  100
----------------------------------------before generate_dataloader_block 
 Nvidia-smi: 2.0242919921875 GB
    Memory Allocated: 0.0006527900695800781  GigaBytes
Max Memory Allocated: 0.0006527900695800781  GigaBytes

The real block id is  2
get_global_graph_edges_ids_block function  spend 0.6797018051147461
range selection method range initialization spend 0.02888202667236328
time for parepare:  0.3948235511779785
local_output_nid generation:  0.00689697265625
local_in_edges_tensor generation:  0.045349836349487305
mini_batch_src_global generation:  0.055802106857299805
r_  generation:  0.8277044296264648
local_output_nid generation:  0.007437229156494141
local_in_edges_tensor generation:  0.026164531707763672
mini_batch_src_global generation:  0.07105779647827148
r_  generation:  0.8858850002288818
local_output_nid generation:  0.007589578628540039
local_in_edges_tensor generation:  0.024097442626953125
mini_batch_src_global generation:  0.04952692985534668
r_  generation:  0.9499239921569824
local_output_nid generation:  0.007814168930053711
local_in_edges_tensor generation:  0.03822660446166992
mini_batch_src_global generation:  0.05821967124938965
r_  generation:  0.9945671558380127
local_output_nid generation:  0.0078125
local_in_edges_tensor generation:  0.030560970306396484
mini_batch_src_global generation:  0.07152700424194336
r_  generation:  1.0870375633239746
local_output_nid generation:  0.007843494415283203
local_in_edges_tensor generation:  0.01913619041442871
mini_batch_src_global generation:  0.07402801513671875
r_  generation:  1.0670177936553955
local_output_nid generation:  0.00787806510925293
local_in_edges_tensor generation:  0.01584935188293457
mini_batch_src_global generation:  0.07202553749084473
r_  generation:  1.1071908473968506
local_output_nid generation:  0.007775545120239258
local_in_edges_tensor generation:  0.02069997787475586
mini_batch_src_global generation:  0.08313393592834473
r_  generation:  1.103625774383545
----------------------check_connections_block total spend ----------------------------- 10.494061470031738
generate_one_block  6.671752452850342
generate_one_block  1.123718500137329
generate_one_block  1.0432727336883545
generate_one_block  1.0289199352264404
generate_one_block  1.135373592376709
generate_one_block  1.0632901191711426
generate_one_block  1.06437087059021
generate_one_block  1.0167510509490967
The real block id is  1
get_global_graph_edges_ids_block function  spend 3.3900530338287354
gen group dst list time:  0.1683511734008789
time for parepare:  0.4523427486419678
local_output_nid generation:  0.1418454647064209
local_in_edges_tensor generation:  0.8586349487304688
mini_batch_src_global generation:  1.2608554363250732
r_  generation:  14.790284395217896
local_output_nid generation:  0.21590185165405273
local_in_edges_tensor generation:  0.8516809940338135
mini_batch_src_global generation:  1.632556676864624
r_  generation:  14.943544387817383
local_output_nid generation:  0.23670172691345215
local_in_edges_tensor generation:  1.0803370475769043
mini_batch_src_global generation:  1.5907280445098877
r_  generation:  15.386038064956665
local_output_nid generation:  0.2685515880584717
local_in_edges_tensor generation:  0.9338200092315674
mini_batch_src_global generation:  1.7041525840759277
r_  generation:  15.500326156616211
local_output_nid generation:  0.2832932472229004
local_in_edges_tensor generation:  1.2152776718139648
mini_batch_src_global generation:  1.7698602676391602
r_  generation:  15.6473970413208
local_output_nid generation:  0.2903473377227783
local_in_edges_tensor generation:  1.1384997367858887
mini_batch_src_global generation:  1.6501286029815674
r_  generation:  15.807525396347046
local_output_nid generation:  0.2654383182525635
local_in_edges_tensor generation:  1.1626760959625244
mini_batch_src_global generation:  1.6411447525024414
r_  generation:  15.714070796966553
local_output_nid generation:  0.28259968757629395
local_in_edges_tensor generation:  0.9541873931884766
mini_batch_src_global generation:  1.7218656539916992
r_  generation:  15.512726545333862
----------------------check_connections_block total spend ----------------------------- 167.94942474365234
generate_one_block  21.88448929786682
generate_one_block  21.74714183807373
generate_one_block  22.251506090164185
generate_one_block  21.8877055644989
generate_one_block  21.749885320663452
generate_one_block  21.76812243461609
generate_one_block  21.77704620361328
generate_one_block  21.629473209381104
The real block id is  0
get_global_graph_edges_ids_block function  spend 2.1818723678588867
gen group dst list time:  0.6024246215820312
time for parepare:  0.49642300605773926
local_output_nid generation:  0.5313942432403564
local_in_edges_tensor generation:  1.2333109378814697
mini_batch_src_global generation:  1.2304258346557617
r_  generation:  16.76754355430603
local_output_nid generation:  0.6705164909362793
local_in_edges_tensor generation:  1.3144896030426025
mini_batch_src_global generation:  1.6720268726348877
r_  generation:  16.751343727111816
local_output_nid generation:  0.6601533889770508
local_in_edges_tensor generation:  1.4063570499420166
mini_batch_src_global generation:  1.5715675354003906
r_  generation:  16.927652835845947
local_output_nid generation:  0.6693675518035889
local_in_edges_tensor generation:  1.331336259841919
mini_batch_src_global generation:  1.693235158920288
r_  generation:  16.999587535858154
local_output_nid generation:  0.6964926719665527
local_in_edges_tensor generation:  1.3428611755371094
mini_batch_src_global generation:  1.6452610492706299
r_  generation:  17.1474609375
local_output_nid generation:  0.6974959373474121
local_in_edges_tensor generation:  1.3493132591247559
mini_batch_src_global generation:  1.7314233779907227
r_  generation:  17.090940952301025
local_output_nid generation:  0.6997475624084473
local_in_edges_tensor generation:  1.3295214176177979
mini_batch_src_global generation:  1.6567168235778809
r_  generation:  17.219077825546265
local_output_nid generation:  0.6883859634399414
local_in_edges_tensor generation:  1.379279375076294
mini_batch_src_global generation:  1.752530574798584
r_  generation:  17.139126300811768
----------------------check_connections_block total spend ----------------------------- 190.3387188911438
generate_one_block  22.590158700942993
generate_one_block  23.624054193496704
generate_one_block  22.451181173324585
generate_one_block  22.257786512374878
generate_one_block  22.396050691604614
generate_one_block  22.428508281707764
generate_one_block  22.579432010650635
generate_one_block  22.46021604537964
-----------------------------------------after block dataloader generation 
 Nvidia-smi: 2.0242919921875 GB
    Memory Allocated: 0.0006527900695800781  GigaBytes
Max Memory Allocated: 0.0006527900695800781  GigaBytes

connection checking time:  358.28814363479614
block generation total time  355.4827575683594
average batch blocks generation time:  44.43534469604492
----------------------------------------before batch_pred = model(blocks, batch_inputs) 
 Nvidia-smi: 3.5535888671875 GB
    Memory Allocated: 1.4515876770019531  GigaBytes
Max Memory Allocated: 1.4515876770019531  GigaBytes

Traceback (most recent call last):
  File "pseudo_mini_batch_range_products_sage.py", line 455, in <module>
    main()
  File "pseudo_mini_batch_range_products_sage.py", line 451, in main
    best_test = run(args, device, data)
  File "pseudo_mini_batch_range_products_sage.py", line 276, in run
    batch_pred = model(blocks, batch_inputs)#------------*
  File "/home/cc/.local/lib/python3.6/site-packages/torch/nn/modules/module.py", line 727, in _call_impl
    result = self.forward(*input, **kwargs)
  File "/home/cc/graph_partition_multi_layers/pseudo_mini_batch_full_batch/SAGE/graphsage_model_products.py", line 48, in forward
    x = layer(block, x)
  File "/home/cc/.local/lib/python3.6/site-packages/torch/nn/modules/module.py", line 727, in _call_impl
    result = self.forward(*input, **kwargs)
  File "/home/cc/.local/lib/python3.6/site-packages/dgl/nn/pytorch/conv/sageconv.py", line 258, in forward
    graph.update_all(msg_fn, self._lstm_reducer)
  File "/home/cc/.local/lib/python3.6/site-packages/dgl/heterograph.py", line 4849, in update_all
    ndata = core.message_passing(g, message_func, reduce_func, apply_node_func)
  File "/home/cc/.local/lib/python3.6/site-packages/dgl/core.py", line 337, in message_passing
    ndata = invoke_udf_reduce(g, rfunc, msgdata, orig_nid=orig_nid)
  File "/home/cc/.local/lib/python3.6/site-packages/dgl/core.py", line 143, in invoke_udf_reduce
    bkt_rsts.append(func(nbatch))
  File "/home/cc/.local/lib/python3.6/site-packages/dgl/nn/pytorch/conv/sageconv.py", line 173, in _lstm_reducer
    _, (rst, _) = self.lstm(m, h)
  File "/home/cc/.local/lib/python3.6/site-packages/torch/nn/modules/module.py", line 727, in _call_impl
    result = self.forward(*input, **kwargs)
  File "/home/cc/.local/lib/python3.6/site-packages/torch/nn/modules/rnn.py", line 582, in forward
    self.dropout, self.training, self.bidirectional, self.batch_first)
RuntimeError: CUDA out of memory. Tried to allocate 70.00 MiB (GPU 0; 23.62 GiB total capacity; 20.80 GiB already allocated; 59.44 MiB free; 20.94 GiB reserved in total by PyTorch)
