Using backend: pytorch
main start at this time 1648255036.2660139
#nodes: 2449029
#edges: 123718024
#classes: 47
success----------------------------------------
196571
39255
2164782
# Nodes: 2400608
# Edges: 123718024
# Train: 196571
# Val: 39255
# Test: 2164782
# Classes: 47

in feats:  100
----------------------------------------before generate_dataloader_block 
 Nvidia-smi: 2.0242919921875 GB
    Memory Allocated: 0.0006527900695800781  GigaBytes
Max Memory Allocated: 0.0006527900695800781  GigaBytes

The real block id is  2
get_global_graph_edges_ids_block function  spend 0.3410966396331787
range selection method range initialization spend 0.029948949813842773
time for parepare:  0.27643847465515137
local_output_nid generation:  0.006157875061035156
local_in_edges_tensor generation:  0.02535247802734375
mini_batch_src_global generation:  0.027324676513671875
r_  generation:  0.40399885177612305
local_output_nid generation:  0.007467746734619141
local_in_edges_tensor generation:  0.01401209831237793
mini_batch_src_global generation:  0.039560794830322266
r_  generation:  0.4559624195098877
local_output_nid generation:  0.0071489810943603516
local_in_edges_tensor generation:  0.007995367050170898
mini_batch_src_global generation:  0.0260164737701416
r_  generation:  0.47454309463500977
local_output_nid generation:  0.00736236572265625
local_in_edges_tensor generation:  0.006575345993041992
mini_batch_src_global generation:  0.02935957908630371
r_  generation:  0.5190596580505371
local_output_nid generation:  0.007277488708496094
local_in_edges_tensor generation:  0.011343717575073242
mini_batch_src_global generation:  0.036705970764160156
r_  generation:  0.5430686473846436
local_output_nid generation:  0.0073146820068359375
local_in_edges_tensor generation:  0.009159564971923828
mini_batch_src_global generation:  0.0364229679107666
r_  generation:  0.5546765327453613
local_output_nid generation:  0.007178544998168945
local_in_edges_tensor generation:  0.006495475769042969
mini_batch_src_global generation:  0.0371251106262207
r_  generation:  0.5778191089630127
local_output_nid generation:  0.007189035415649414
local_in_edges_tensor generation:  0.006690025329589844
mini_batch_src_global generation:  0.03870248794555664
r_  generation:  0.5741815567016602
----------------------check_connections_block total spend ----------------------------- 5.486972332000732
generate_one_block  5.71635365486145
generate_one_block  0.6273818016052246
generate_one_block  0.5907576084136963
generate_one_block  0.5870532989501953
generate_one_block  0.6375200748443604
generate_one_block  0.5945463180541992
generate_one_block  0.5940871238708496
generate_one_block  0.6297032833099365
The real block id is  1
get_global_graph_edges_ids_block function  spend 2.042874813079834
gen group dst list time:  0.12402892112731934
time for parepare:  0.4329698085784912
local_output_nid generation:  0.1003870964050293
local_in_edges_tensor generation:  0.42731738090515137
mini_batch_src_global generation:  0.5307660102844238
r_  generation:  7.0040693283081055
local_output_nid generation:  0.13838958740234375
local_in_edges_tensor generation:  0.40639281272888184
mini_batch_src_global generation:  0.6641724109649658
r_  generation:  7.209608554840088
local_output_nid generation:  0.1524217128753662
local_in_edges_tensor generation:  0.48974013328552246
mini_batch_src_global generation:  0.6527600288391113
r_  generation:  7.376685619354248
local_output_nid generation:  0.1671152114868164
local_in_edges_tensor generation:  0.45567893981933594
mini_batch_src_global generation:  0.6818497180938721
r_  generation:  7.556507587432861
local_output_nid generation:  0.16532325744628906
local_in_edges_tensor generation:  0.46087193489074707
mini_batch_src_global generation:  0.6947159767150879
r_  generation:  7.643690347671509
local_output_nid generation:  0.19098424911499023
local_in_edges_tensor generation:  0.4681251049041748
mini_batch_src_global generation:  0.7024796009063721
r_  generation:  7.678377151489258
local_output_nid generation:  0.18143916130065918
local_in_edges_tensor generation:  0.47583603858947754
mini_batch_src_global generation:  0.7573678493499756
r_  generation:  7.642101526260376
local_output_nid generation:  0.17937302589416504
local_in_edges_tensor generation:  0.5459611415863037
mini_batch_src_global generation:  0.7089841365814209
r_  generation:  7.71980881690979
----------------------check_connections_block total spend ----------------------------- 80.34542989730835
generate_one_block  10.051337242126465
generate_one_block  9.538744449615479
generate_one_block  10.296029806137085
generate_one_block  9.657797813415527
generate_one_block  9.549494743347168
generate_one_block  9.984318256378174
generate_one_block  9.627452850341797
generate_one_block  9.967907428741455
The real block id is  0
get_global_graph_edges_ids_block function  spend 2.2663159370422363
gen group dst list time:  0.5364959239959717
time for parepare:  0.48259401321411133
local_output_nid generation:  0.4722309112548828
local_in_edges_tensor generation:  1.1853559017181396
mini_batch_src_global generation:  1.1660470962524414
r_  generation:  16.084399223327637
local_output_nid generation:  0.5879025459289551
local_in_edges_tensor generation:  1.2492132186889648
mini_batch_src_global generation:  1.4774632453918457
r_  generation:  15.990900039672852
local_output_nid generation:  0.57218337059021
local_in_edges_tensor generation:  1.2844812870025635
mini_batch_src_global generation:  1.5304691791534424
r_  generation:  16.677732467651367
local_output_nid generation:  0.6432356834411621
local_in_edges_tensor generation:  1.3419570922851562
mini_batch_src_global generation:  1.5980498790740967
r_  generation:  16.188132762908936
local_output_nid generation:  0.630875825881958
local_in_edges_tensor generation:  1.172356367111206
mini_batch_src_global generation:  1.5119853019714355
r_  generation:  16.193755626678467
local_output_nid generation:  0.6418874263763428
local_in_edges_tensor generation:  1.2141246795654297
mini_batch_src_global generation:  1.5529217720031738
r_  generation:  16.04532766342163
local_output_nid generation:  0.6521754264831543
local_in_edges_tensor generation:  1.2638123035430908
mini_batch_src_global generation:  1.5519273281097412
r_  generation:  16.337918996810913
local_output_nid generation:  0.656987190246582
local_in_edges_tensor generation:  1.2605290412902832
mini_batch_src_global generation:  1.4623119831085205
r_  generation:  16.39152455329895
----------------------check_connections_block total spend ----------------------------- 179.8288803100586
generate_one_block  21.444966077804565
generate_one_block  22.003348350524902
generate_one_block  20.760470628738403
generate_one_block  21.051828384399414
generate_one_block  21.113780736923218
generate_one_block  21.21617031097412
generate_one_block  21.34804630279541
generate_one_block  21.289402723312378
-----------------------------------------after block dataloader generation 
 Nvidia-smi: 2.0242919921875 GB
    Memory Allocated: 0.0006527900695800781  GigaBytes
Max Memory Allocated: 0.0006527900695800781  GigaBytes

connection checking time:  260.17431020736694
block generation total time  248.90109610557556
average batch blocks generation time:  31.112637013196945
----------------------------------------before batch_pred = model(blocks, batch_inputs) 
 Nvidia-smi: 3.3289794921875 GB
    Memory Allocated: 1.2251367568969727  GigaBytes
Max Memory Allocated: 1.2251367568969727  GigaBytes

Traceback (most recent call last):
  File "pseudo_mini_batch_range_products_sage.py", line 455, in <module>
    main()
  File "pseudo_mini_batch_range_products_sage.py", line 451, in main
    best_test = run(args, device, data)
  File "pseudo_mini_batch_range_products_sage.py", line 276, in run
    batch_pred = model(blocks, batch_inputs)#------------*
  File "/home/cc/.local/lib/python3.6/site-packages/torch/nn/modules/module.py", line 727, in _call_impl
    result = self.forward(*input, **kwargs)
  File "/home/cc/graph_partition_multi_layers/pseudo_mini_batch_full_batch/SAGE/graphsage_model_products.py", line 48, in forward
    x = layer(block, x)
  File "/home/cc/.local/lib/python3.6/site-packages/torch/nn/modules/module.py", line 727, in _call_impl
    result = self.forward(*input, **kwargs)
  File "/home/cc/.local/lib/python3.6/site-packages/dgl/nn/pytorch/conv/sageconv.py", line 258, in forward
    graph.update_all(msg_fn, self._lstm_reducer)
  File "/home/cc/.local/lib/python3.6/site-packages/dgl/heterograph.py", line 4849, in update_all
    ndata = core.message_passing(g, message_func, reduce_func, apply_node_func)
  File "/home/cc/.local/lib/python3.6/site-packages/dgl/core.py", line 337, in message_passing
    ndata = invoke_udf_reduce(g, rfunc, msgdata, orig_nid=orig_nid)
  File "/home/cc/.local/lib/python3.6/site-packages/dgl/core.py", line 143, in invoke_udf_reduce
    bkt_rsts.append(func(nbatch))
  File "/home/cc/.local/lib/python3.6/site-packages/dgl/nn/pytorch/conv/sageconv.py", line 173, in _lstm_reducer
    _, (rst, _) = self.lstm(m, h)
  File "/home/cc/.local/lib/python3.6/site-packages/torch/nn/modules/module.py", line 727, in _call_impl
    result = self.forward(*input, **kwargs)
  File "/home/cc/.local/lib/python3.6/site-packages/torch/nn/modules/rnn.py", line 582, in forward
    self.dropout, self.training, self.bidirectional, self.batch_first)
RuntimeError: CUDA out of memory. Tried to allocate 50.00 MiB (GPU 0; 23.62 GiB total capacity; 20.87 GiB already allocated; 15.44 MiB free; 21.01 GiB reserved in total by PyTorch)
