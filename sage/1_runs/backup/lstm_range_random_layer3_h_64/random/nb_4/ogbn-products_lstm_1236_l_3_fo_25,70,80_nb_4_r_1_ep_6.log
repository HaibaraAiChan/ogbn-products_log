Using backend: pytorch
main start at this time 1648210307.433232
#nodes: 2449029
#edges: 123718024
#classes: 47
success----------------------------------------
196571
39255
2164782
# Nodes: 2400608
# Edges: 123718024
# Train: 196571
# Val: 39255
# Test: 2164782
# Classes: 47

in feats:  100
----------------------------------------before generate_dataloader_block 
 Nvidia-smi: 2.0242919921875 GB
    Memory Allocated: 0.0006527900695800781  GigaBytes
Max Memory Allocated: 0.0006527900695800781  GigaBytes

The real block id is  2
get_global_graph_edges_ids_block function  spend 0.6409547328948975
random selection method range initialization spend 0.016695261001586914
time for parepare:  0.3747420310974121
local_output_nid generation:  0.024905920028686523
local_in_edges_tensor generation:  0.09209537506103516
mini_batch_src_global generation:  0.10893678665161133
r_  generation:  1.5856482982635498
local_output_nid generation:  0.025595426559448242
local_in_edges_tensor generation:  0.07092714309692383
mini_batch_src_global generation:  0.12914347648620605
r_  generation:  1.683931827545166
local_output_nid generation:  0.025426387786865234
local_in_edges_tensor generation:  0.06618070602416992
mini_batch_src_global generation:  0.1090390682220459
r_  generation:  1.7057461738586426
local_output_nid generation:  0.0259246826171875
local_in_edges_tensor generation:  0.06388282775878906
mini_batch_src_global generation:  0.12049245834350586
r_  generation:  1.808161973953247
----------------------check_connections_block total spend ----------------------------- 9.017358779907227
generate_one_block  7.19564414024353
generate_one_block  2.122494697570801
generate_one_block  2.121732473373413
generate_one_block  2.134277105331421
The real block id is  1
get_global_graph_edges_ids_block function  spend 3.3436334133148193
gen group dst list time:  0.11699151992797852
time for parepare:  0.44243621826171875
local_output_nid generation:  0.3209092617034912
local_in_edges_tensor generation:  1.317617416381836
mini_batch_src_global generation:  1.6051545143127441
r_  generation:  19.44273805618286
local_output_nid generation:  0.332165002822876
local_in_edges_tensor generation:  1.1914684772491455
mini_batch_src_global generation:  2.095214605331421
r_  generation:  19.697768688201904
local_output_nid generation:  0.36832380294799805
local_in_edges_tensor generation:  1.4278850555419922
mini_batch_src_global generation:  2.0370500087738037
r_  generation:  20.331750631332397
local_output_nid generation:  0.3685729503631592
local_in_edges_tensor generation:  2.3220582008361816
mini_batch_src_global generation:  2.0537142753601074
r_  generation:  20.7233304977417
----------------------check_connections_block total spend ----------------------------- 110.32620406150818
generate_one_block  28.121649265289307
generate_one_block  27.952230215072632
generate_one_block  28.142242670059204
generate_one_block  28.14064121246338
The real block id is  0
get_global_graph_edges_ids_block function  spend 2.1766841411590576
gen group dst list time:  0.3326430320739746
time for parepare:  0.48955273628234863
local_output_nid generation:  0.6638638973236084
local_in_edges_tensor generation:  1.476783275604248
mini_batch_src_global generation:  1.2849974632263184
r_  generation:  17.640172243118286
local_output_nid generation:  0.7235791683197021
local_in_edges_tensor generation:  1.458833932876587
mini_batch_src_global generation:  1.6624641418457031
r_  generation:  17.40274429321289
local_output_nid generation:  0.7227528095245361
local_in_edges_tensor generation:  1.3835270404815674
mini_batch_src_global generation:  1.962573766708374
r_  generation:  18.3201904296875
local_output_nid generation:  0.721123218536377
local_in_edges_tensor generation:  1.3700599670410156
mini_batch_src_global generation:  1.7093021869659424
r_  generation:  17.97149395942688
----------------------check_connections_block total spend ----------------------------- 100.18083453178406
generate_one_block  23.229578256607056
generate_one_block  23.149476766586304
generate_one_block  23.131500244140625
generate_one_block  23.889039278030396
-----------------------------------------after block dataloader generation 
 Nvidia-smi: 2.0242919921875 GB
    Memory Allocated: 0.0006527900695800781  GigaBytes
Max Memory Allocated: 0.0006527900695800781  GigaBytes

connection checking time:  210.50703859329224
block generation total time  205.7563579082489
average batch blocks generation time:  51.439089477062225
----------------------------------------before batch_pred = model(blocks, batch_inputs) 
 Nvidia-smi: 3.6610107421875 GB
    Memory Allocated: 1.5700411796569824  GigaBytes
Max Memory Allocated: 1.5700411796569824  GigaBytes

Traceback (most recent call last):
  File "pseudo_mini_batch_range_products_sage.py", line 455, in <module>
    main()
  File "pseudo_mini_batch_range_products_sage.py", line 451, in main
    best_test = run(args, device, data)
  File "pseudo_mini_batch_range_products_sage.py", line 276, in run
    batch_pred = model(blocks, batch_inputs)#------------*
  File "/home/cc/.local/lib/python3.6/site-packages/torch/nn/modules/module.py", line 727, in _call_impl
    result = self.forward(*input, **kwargs)
  File "/home/cc/graph_partition_multi_layers/pseudo_mini_batch_full_batch/SAGE/graphsage_model_products.py", line 48, in forward
    x = layer(block, x)
  File "/home/cc/.local/lib/python3.6/site-packages/torch/nn/modules/module.py", line 727, in _call_impl
    result = self.forward(*input, **kwargs)
  File "/home/cc/.local/lib/python3.6/site-packages/dgl/nn/pytorch/conv/sageconv.py", line 258, in forward
    graph.update_all(msg_fn, self._lstm_reducer)
  File "/home/cc/.local/lib/python3.6/site-packages/dgl/heterograph.py", line 4849, in update_all
    ndata = core.message_passing(g, message_func, reduce_func, apply_node_func)
  File "/home/cc/.local/lib/python3.6/site-packages/dgl/core.py", line 337, in message_passing
    ndata = invoke_udf_reduce(g, rfunc, msgdata, orig_nid=orig_nid)
  File "/home/cc/.local/lib/python3.6/site-packages/dgl/core.py", line 143, in invoke_udf_reduce
    bkt_rsts.append(func(nbatch))
  File "/home/cc/.local/lib/python3.6/site-packages/dgl/nn/pytorch/conv/sageconv.py", line 173, in _lstm_reducer
    _, (rst, _) = self.lstm(m, h)
  File "/home/cc/.local/lib/python3.6/site-packages/torch/nn/modules/module.py", line 727, in _call_impl
    result = self.forward(*input, **kwargs)
  File "/home/cc/.local/lib/python3.6/site-packages/torch/nn/modules/rnn.py", line 582, in forward
    self.dropout, self.training, self.bidirectional, self.batch_first)
RuntimeError: CUDA out of memory. Tried to allocate 82.00 MiB (GPU 0; 23.62 GiB total capacity; 20.83 GiB already allocated; 5.44 MiB free; 20.98 GiB reserved in total by PyTorch)
