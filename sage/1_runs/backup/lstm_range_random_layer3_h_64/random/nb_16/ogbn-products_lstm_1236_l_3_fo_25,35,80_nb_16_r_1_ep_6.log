main start at this time 1648196048.6381178
#nodes: 2449029
#edges: 123718024
#classes: 47
success----------------------------------------
196571
39255
2164782
# Nodes: 2400608
# Edges: 123718024
# Train: 196571
# Val: 39255
# Test: 2164782
# Classes: 47

in feats:  100
----------------------------------------before generate_dataloader_block 
 Nvidia-smi: 2.0242919921875 GB
    Memory Allocated: 0.0006527900695800781  GigaBytes
Max Memory Allocated: 0.0006527900695800781  GigaBytes

The real block id is  2
get_global_graph_edges_ids_block function  spend 0.6514124870300293
random selection method range initialization spend 0.017778635025024414
time for parepare:  0.36469554901123047
local_output_nid generation:  0.006924629211425781
local_in_edges_tensor generation:  0.03788495063781738
mini_batch_src_global generation:  0.02516937255859375
r_  generation:  0.3552999496459961
local_output_nid generation:  0.007153749465942383
local_in_edges_tensor generation:  0.018555402755737305
mini_batch_src_global generation:  0.06048011779785156
r_  generation:  0.4064462184906006
local_output_nid generation:  0.00716400146484375
local_in_edges_tensor generation:  0.012061834335327148
mini_batch_src_global generation:  0.024579286575317383
r_  generation:  0.42487263679504395
local_output_nid generation:  0.007179975509643555
local_in_edges_tensor generation:  0.009937047958374023
mini_batch_src_global generation:  0.025763988494873047
r_  generation:  0.453383207321167
local_output_nid generation:  0.007128477096557617
local_in_edges_tensor generation:  0.009267807006835938
mini_batch_src_global generation:  0.027637243270874023
r_  generation:  0.4739203453063965
local_output_nid generation:  0.007138252258300781
local_in_edges_tensor generation:  0.009949922561645508
mini_batch_src_global generation:  0.03461933135986328
r_  generation:  0.48507022857666016
local_output_nid generation:  0.00709986686706543
local_in_edges_tensor generation:  0.010657548904418945
mini_batch_src_global generation:  0.03173208236694336
r_  generation:  0.4986855983734131
local_output_nid generation:  0.007094860076904297
local_in_edges_tensor generation:  0.012934684753417969
mini_batch_src_global generation:  0.03291893005371094
r_  generation:  0.5072240829467773
local_output_nid generation:  0.0071086883544921875
local_in_edges_tensor generation:  0.00958871841430664
mini_batch_src_global generation:  0.034687042236328125
r_  generation:  0.5045201778411865
local_output_nid generation:  0.0070953369140625
local_in_edges_tensor generation:  0.00934147834777832
mini_batch_src_global generation:  0.0355527400970459
r_  generation:  0.5139889717102051
local_output_nid generation:  0.007083892822265625
local_in_edges_tensor generation:  0.009376764297485352
mini_batch_src_global generation:  0.037059783935546875
r_  generation:  0.5153203010559082
local_output_nid generation:  0.007094621658325195
local_in_edges_tensor generation:  0.009011507034301758
mini_batch_src_global generation:  0.03868389129638672
r_  generation:  0.5210347175598145
local_output_nid generation:  0.007114410400390625
local_in_edges_tensor generation:  0.009238004684448242
mini_batch_src_global generation:  0.042909860610961914
r_  generation:  0.5172991752624512
local_output_nid generation:  0.007150888442993164
local_in_edges_tensor generation:  0.009036779403686523
mini_batch_src_global generation:  0.04019045829772949
r_  generation:  0.5278286933898926
local_output_nid generation:  0.0071620941162109375
local_in_edges_tensor generation:  0.009252071380615234
mini_batch_src_global generation:  0.04155850410461426
r_  generation:  0.5282182693481445
local_output_nid generation:  0.0071675777435302734
local_in_edges_tensor generation:  0.008817434310913086
mini_batch_src_global generation:  0.0417633056640625
r_  generation:  0.522707462310791
----------------------check_connections_block total spend ----------------------------- 10.336219787597656
generate_one_block  5.621952772140503
generate_one_block  0.4937570095062256
generate_one_block  0.5147876739501953
generate_one_block  0.5044093132019043
generate_one_block  0.5006611347198486
generate_one_block  0.5027179718017578
generate_one_block  0.5109472274780273
generate_one_block  0.5043272972106934
generate_one_block  0.5033423900604248
generate_one_block  0.504737377166748
generate_one_block  0.5117623805999756
generate_one_block  0.5061075687408447
generate_one_block  0.5078911781311035
generate_one_block  0.5113837718963623
generate_one_block  0.5045766830444336
generate_one_block  0.5049629211425781
The real block id is  1
get_global_graph_edges_ids_block function  spend 2.2199466228485107
gen group dst list time:  0.24982857704162598
time for parepare:  0.47251009941101074
local_output_nid generation:  0.17480826377868652
local_in_edges_tensor generation:  0.5608139038085938
mini_batch_src_global generation:  0.528062105178833
r_  generation:  6.743074893951416
local_output_nid generation:  0.20363306999206543
local_in_edges_tensor generation:  0.5749380588531494
mini_batch_src_global generation:  0.6596512794494629
r_  generation:  6.882775068283081
local_output_nid generation:  0.20254731178283691
local_in_edges_tensor generation:  0.6856179237365723
mini_batch_src_global generation:  0.6368892192840576
r_  generation:  6.806167364120483
local_output_nid generation:  0.1756143569946289
local_in_edges_tensor generation:  0.4428555965423584
mini_batch_src_global generation:  0.7081155776977539
r_  generation:  6.911822319030762
local_output_nid generation:  0.1776871681213379
local_in_edges_tensor generation:  0.5702393054962158
mini_batch_src_global generation:  0.6897704601287842
r_  generation:  6.761250019073486
local_output_nid generation:  0.18011474609375
local_in_edges_tensor generation:  0.4413442611694336
mini_batch_src_global generation:  0.7004485130310059
r_  generation:  7.013292551040649
local_output_nid generation:  0.17408275604248047
local_in_edges_tensor generation:  0.48335719108581543
mini_batch_src_global generation:  0.6834890842437744
r_  generation:  7.000256061553955
local_output_nid generation:  0.20003414154052734
local_in_edges_tensor generation:  0.5100748538970947
mini_batch_src_global generation:  0.6802358627319336
r_  generation:  6.917110919952393
local_output_nid generation:  0.1704564094543457
local_in_edges_tensor generation:  0.44318127632141113
mini_batch_src_global generation:  0.7100756168365479
r_  generation:  6.966623544692993
local_output_nid generation:  0.16855311393737793
local_in_edges_tensor generation:  0.5577261447906494
mini_batch_src_global generation:  0.7211244106292725
r_  generation:  6.948503494262695
local_output_nid generation:  0.20210480690002441
local_in_edges_tensor generation:  0.4383258819580078
mini_batch_src_global generation:  0.6868417263031006
r_  generation:  7.016644477844238
local_output_nid generation:  0.17055082321166992
local_in_edges_tensor generation:  0.4333946704864502
mini_batch_src_global generation:  0.6912798881530762
r_  generation:  7.019690275192261
local_output_nid generation:  0.20750069618225098
local_in_edges_tensor generation:  0.5567977428436279
mini_batch_src_global generation:  0.6929726600646973
r_  generation:  6.913443326950073
local_output_nid generation:  0.17566466331481934
local_in_edges_tensor generation:  0.4407768249511719
mini_batch_src_global generation:  0.7229018211364746
r_  generation:  7.083988428115845
local_output_nid generation:  0.17629671096801758
local_in_edges_tensor generation:  0.5240733623504639
mini_batch_src_global generation:  0.7128276824951172
r_  generation:  6.991926908493042
local_output_nid generation:  0.20225906372070312
local_in_edges_tensor generation:  0.4722411632537842
mini_batch_src_global generation:  0.6908180713653564
r_  generation:  7.059730052947998
----------------------check_connections_block total spend ----------------------------- 152.41375970840454
generate_one_block  9.822279930114746
generate_one_block  9.280242681503296
generate_one_block  9.023029327392578
generate_one_block  9.009960174560547
generate_one_block  9.153075456619263
generate_one_block  8.936434984207153
generate_one_block Using backend: pytorch
 9.285151243209839
generate_one_block  9.062537670135498
generate_one_block  9.093538045883179
generate_one_block  9.287676811218262
generate_one_block  8.990061521530151
generate_one_block  9.196487188339233
generate_one_block  9.051175355911255
generate_one_block  8.991237878799438
generate_one_block  9.305370569229126
generate_one_block  8.978763103485107
The real block id is  0
get_global_graph_edges_ids_block function  spend 2.3204925060272217
gen group dst list time:  1.017392635345459
time for parepare:  0.46716809272766113
local_output_nid generation:  0.576770544052124
local_in_edges_tensor generation:  1.3104596138000488
mini_batch_src_global generation:  1.14377760887146
r_  generation:  14.756821632385254
local_output_nid generation:  0.6228666305541992
local_in_edges_tensor generation:  1.2698774337768555
mini_batch_src_global generation:  1.5037291049957275
r_  generation:  14.623725414276123
local_output_nid generation:  0.6044800281524658
local_in_edges_tensor generation:  1.344503402709961
mini_batch_src_global generation:  1.5485787391662598
r_  generation:  14.952165126800537
local_output_nid generation:  0.6163690090179443
local_in_edges_tensor generation:  1.2075328826904297
mini_batch_src_global generation:  1.4563281536102295
r_  generation:  15.002557754516602
local_output_nid generation:  0.6103918552398682
local_in_edges_tensor generation:  1.2106826305389404
mini_batch_src_global generation:  1.4029154777526855
r_  generation:  14.990465879440308
local_output_nid generation:  0.5695281028747559
local_in_edges_tensor generation:  2.2368571758270264
mini_batch_src_global generation:  1.4428720474243164
r_  generation:  14.85810923576355
local_output_nid generation:  0.6158289909362793
local_in_edges_tensor generation:  1.2044453620910645
mini_batch_src_global generation:  1.5457594394683838
r_  generation:  15.030677080154419
local_output_nid generation:  0.6153650283813477
local_in_edges_tensor generation:  1.1963462829589844
mini_batch_src_global generation:  1.4080185890197754
r_  generation:  15.119322061538696
local_output_nid generation:  0.5909881591796875
local_in_edges_tensor generation:  1.2264306545257568
mini_batch_src_global generation:  1.450124979019165
r_  generation:  14.936298370361328
local_output_nid generation:  0.5817506313323975
local_in_edges_tensor generation:  1.082042932510376
mini_batch_src_global generation:  1.5219080448150635
r_  generation:  15.56223440170288
local_output_nid generation:  0.610846757888794
local_in_edges_tensor generation:  1.2157914638519287
mini_batch_src_global generation:  1.595036268234253
r_  generation:  15.096924543380737
local_output_nid generation:  0.61319899559021
local_in_edges_tensor generation:  1.2054214477539062
mini_batch_src_global generation:  1.4188148975372314
r_  generation:  15.115784883499146
local_output_nid generation:  0.561262845993042
local_in_edges_tensor generation:  1.2272875308990479
mini_batch_src_global generation:  1.4403231143951416
r_  generation:  14.956460237503052
local_output_nid generation:  0.5938770771026611
local_in_edges_tensor generation:  1.0880043506622314
mini_batch_src_global generation:  1.469637155532837
r_  generation:  15.042710781097412
local_output_nid generation:  0.6133971214294434
local_in_edges_tensor generation:  1.2187891006469727
mini_batch_src_global generation:  1.5021615028381348
r_  generation:  15.191030979156494
local_output_nid generation:  0.6151525974273682
local_in_edges_tensor generation:  1.2044622898101807
mini_batch_src_global generation:  1.4217700958251953
r_  generation:  15.178527116775513
----------------------check_connections_block total spend ----------------------------- 337.4120213985443
generate_one_block  20.29506230354309
generate_one_block  20.076675415039062
generate_one_block  19.933668613433838
generate_one_block  19.98444414138794
generate_one_block  20.053115606307983
generate_one_block  20.24701952934265
generate_one_block  20.97777223587036
generate_one_block  20.180691480636597
generate_one_block  19.73249125480652
generate_one_block  19.954969882965088
generate_one_block  20.0459303855896
generate_one_block  20.098695278167725
generate_one_block  20.024707555770874
generate_one_block  20.138587474822998
generate_one_block  20.16038942337036
generate_one_block  20.450705528259277
-----------------------------------------after block dataloader generation 
 Nvidia-smi: 2.0242919921875 GB
    Memory Allocated: 0.0006527900695800781  GigaBytes
Max Memory Allocated: 0.0006527900695800781  GigaBytes

connection checking time:  489.82578110694885
block generation total time  468.82194805145264
average batch blocks generation time:  29.30137175321579
----------------------------------------before batch_pred = model(blocks, batch_inputs) 
 Nvidia-smi: 3.3094482421875 GB
    Memory Allocated: 1.2082452774047852  GigaBytes
Max Memory Allocated: 1.2082452774047852  GigaBytes

Traceback (most recent call last):
  File "pseudo_mini_batch_range_products_sage.py", line 455, in <module>
    main()
  File "pseudo_mini_batch_range_products_sage.py", line 451, in main
    best_test = run(args, device, data)
  File "pseudo_mini_batch_range_products_sage.py", line 276, in run
    batch_pred = model(blocks, batch_inputs)#------------*
  File "/home/cc/.local/lib/python3.6/site-packages/torch/nn/modules/module.py", line 727, in _call_impl
    result = self.forward(*input, **kwargs)
  File "/home/cc/graph_partition_multi_layers/pseudo_mini_batch_full_batch/SAGE/graphsage_model_products.py", line 48, in forward
    x = layer(block, x)
  File "/home/cc/.local/lib/python3.6/site-packages/torch/nn/modules/module.py", line 727, in _call_impl
    result = self.forward(*input, **kwargs)
  File "/home/cc/.local/lib/python3.6/site-packages/dgl/nn/pytorch/conv/sageconv.py", line 258, in forward
    graph.update_all(msg_fn, self._lstm_reducer)
  File "/home/cc/.local/lib/python3.6/site-packages/dgl/heterograph.py", line 4849, in update_all
    ndata = core.message_passing(g, message_func, reduce_func, apply_node_func)
  File "/home/cc/.local/lib/python3.6/site-packages/dgl/core.py", line 337, in message_passing
    ndata = invoke_udf_reduce(g, rfunc, msgdata, orig_nid=orig_nid)
  File "/home/cc/.local/lib/python3.6/site-packages/dgl/core.py", line 143, in invoke_udf_reduce
    bkt_rsts.append(func(nbatch))
  File "/home/cc/.local/lib/python3.6/site-packages/dgl/nn/pytorch/conv/sageconv.py", line 173, in _lstm_reducer
    _, (rst, _) = self.lstm(m, h)
  File "/home/cc/.local/lib/python3.6/site-packages/torch/nn/modules/module.py", line 727, in _call_impl
    result = self.forward(*input, **kwargs)
  File "/home/cc/.local/lib/python3.6/site-packages/torch/nn/modules/rnn.py", line 582, in forward
    self.dropout, self.training, self.bidirectional, self.batch_first)
RuntimeError: CUDA out of memory. Tried to allocate 46.00 MiB (GPU 0; 23.62 GiB total capacity; 20.88 GiB already allocated; 39.44 MiB free; 21.00 GiB reserved in total by PyTorch)
