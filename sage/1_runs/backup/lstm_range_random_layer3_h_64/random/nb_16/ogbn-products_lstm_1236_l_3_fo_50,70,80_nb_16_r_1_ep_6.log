main start at this time 1648231530.3053641
#nodes: 2449029
#edges: 123718024
#classes: 47
success----------------------------------------
196571
39255
2164782
# Nodes: 2400608
# Edges: 123718024
# Train: 196571
# Val: 39255
# Test: 2164782
# Classes: 47

in feats:  100
----------------------------------------before generate_dataloader_block 
 Nvidia-smi: 2.0242919921875 GB
    Memory Allocated: 0.0006527900695800781  GigaBytes
Max Memory Allocated: 0.0006527900695800781  GigaBytes

The real block id is  2
get_global_graph_edges_ids_block function  spend 0.6281013488769531
random selection method range initialization spend 0.01446390151977539
time for parepare:  0.3643684387207031
local_output_nid generation:  0.006906747817993164
local_in_edges_tensor generation:  0.036950111389160156
mini_batch_src_global generation:  0.025127649307250977
r_  generation:  0.3577737808227539
local_output_nid generation:  0.007126331329345703
local_in_edges_tensor generation:  0.017344951629638672
mini_batch_src_global generation:  0.0334322452545166
r_  generation:  0.4041016101837158
local_output_nid generation:  0.007048845291137695
local_in_edges_tensor generation:  0.010344743728637695
mini_batch_src_global generation:  0.023144960403442383
r_  generation:  0.4212639331817627
local_output_nid generation:  0.0071375370025634766
local_in_edges_tensor generation:  0.010223388671875
mini_batch_src_global generation:  0.025655269622802734
r_  generation:  0.4432532787322998
local_output_nid generation:  0.00711369514465332
local_in_edges_tensor generation:  0.010104656219482422
mini_batch_src_global generation:  0.027901172637939453
r_  generation:  0.461275577545166
local_output_nid generation:  0.007130861282348633
local_in_edges_tensor generation:  0.009779691696166992
mini_batch_src_global generation:  0.030660152435302734
r_  generation:  0.48647546768188477
local_output_nid generation:  0.00704646110534668
local_in_edges_tensor generation:  0.010051488876342773
mini_batch_src_global generation:  0.031790971755981445
r_  generation:  0.49770212173461914
local_output_nid generation:  0.007071256637573242
local_in_edges_tensor generation:  0.010164260864257812
mini_batch_src_global generation:  0.03330397605895996
r_  generation:  0.4969923496246338
local_output_nid generation:  0.007081031799316406
local_in_edges_tensor generation:  0.010175228118896484
mini_batch_src_global generation:  0.03412508964538574
r_  generation:  0.5050122737884521
local_output_nid generation:  0.0071315765380859375
local_in_edges_tensor generation:  0.010190248489379883
mini_batch_src_global generation:  0.03532075881958008
r_  generation:  0.5132138729095459
local_output_nid generation:  0.007168292999267578
local_in_edges_tensor generation:  0.01018214225769043
mini_batch_src_global generation:  0.03692221641540527
r_  generation:  0.5047116279602051
local_output_nid generation:  0.007075786590576172
local_in_edges_tensor generation:  0.010260820388793945
mini_batch_src_global generation:  0.03854227066040039
r_  generation:  0.5194261074066162
local_output_nid generation:  0.0071065425872802734
local_in_edges_tensor generation:  0.010152816772460938
mini_batch_src_global generation:  0.03994131088256836
r_  generation:  0.5245273113250732
local_output_nid generation:  0.0070896148681640625
local_in_edges_tensor generation:  0.010344743728637695
mini_batch_src_global generation:  0.04036974906921387
r_  generation:  0.5277032852172852
local_output_nid generation:  0.007111549377441406
local_in_edges_tensor generation:  0.01007986068725586
mini_batch_src_global generation:  0.0415196418762207
r_  generation:  0.5243356227874756
local_output_nid generation:  0.007028341293334961
local_in_edges_tensor generation:  0.010078907012939453
mini_batch_src_global generation:  0.04207205772399902
r_  generation:  0.5256047248840332
----------------------check_connections_block total spend ----------------------------- 10.260173320770264
generate_one_block  5.581804275512695
generate_one_block  0.487652063369751
generate_one_block  0.5103821754455566
generate_one_block  0.5069503784179688
generate_one_block  0.492612361907959
generate_one_block  0.49619626998901367
generate_one_block  0.5046629905700684
generate_one_block  0.49727797508239746
generate_one_block  0.493074893951416
generate_one_block  0.49976015090942383
generate_one_block  0.5037798881530762
generate_one_block  0.49846553802490234
generate_one_block  0.501091718673706
generate_one_block  0.5040237903594971
generate_one_block  0.4958939552307129
generate_one_block  0.49969983100891113
The real block id is  1
get_global_graph_edges_ids_block function  spend 3.3826940059661865
gen group dst list time:  0.2223513126373291
time for parepare:  0.4752347469329834
local_output_nid generation:  0.15938282012939453
local_in_edges_tensor generation:  0.7726662158966064
mini_batch_src_global generation:  0.8740367889404297
r_  generation:  9.910069942474365
local_output_nid generation:  0.16565704345703125
local_in_edges_tensor generation:  0.6696393489837646
mini_batch_src_global generation:  1.1177871227264404
r_  generation:  10.264755249023438
local_output_nid generation:  0.18160104751586914
local_in_edges_tensor generation:  0.6691279411315918
mini_batch_src_global generation:  1.1839513778686523
r_  generation:  10.50961709022522
local_output_nid generation:  0.17468810081481934
local_in_edges_tensor generation:  0.6669092178344727
mini_batch_src_global generation:  1.1123101711273193
r_  generation:  10.59108567237854
local_output_nid generation:  0.16912484169006348
local_in_edges_tensor generation:  0.8507521152496338
mini_batch_src_global generation:  1.1453838348388672
r_  generation:  10.588098049163818
local_output_nid generation:  0.20090603828430176
local_in_edges_tensor generation:  0.6930980682373047
mini_batch_src_global generation:  1.1957626342773438
r_  generation:  10.793449878692627
local_output_nid generation:  0.19092345237731934
local_in_edges_tensor generation:  1.1453187465667725
mini_batch_src_global generation:  1.1632978916168213
r_  generation:  11.202952861785889
local_output_nid generation:  0.20382308959960938
local_in_edges_tensor generation:  0.8762967586517334
mini_batch_src_global generation:  1.2929050922393799
r_  generation:  10.796586751937866
local_output_nid generation:  0.20125722885131836
local_in_edges_tensor generation:  0.849402904510498
mini_batch_src_global generation:  1.1949336528778076
r_  generation:  10.863778352737427
local_output_nid generation:  0.18122291564941406
local_in_edges_tensor generation:  0.8551113605499268
mini_batch_src_global generation:  1.2275309562683105
r_  generation:  10.718738555908203
local_output_nid generation:  0.18431949615478516
local_in_edges_tensor generation:  0.669975757598877
mini_batch_src_global generation:  1.2585444450378418
r_  generation:  10.895198583602905
local_output_nid generation:  0.20113730430603027
local_in_edges_tensor generation:  0.837583065032959
mini_batch_src_global generation:  1.1596453189849854
r_  generation:  10.897297382354736
local_output_nid generation:  0.17061138153076172
local_in_edges_tensor generation:  0.6686761379241943
mini_batch_src_global generation:  1.198775053024292
r_  generation:  10.853447914123535
local_output_nid generation:  0.20244407653808594
local_in_edges_tensor generation:  0.8408358097076416
mini_batch_src_global generation:  1.1543927192687988
r_  generation:  10.938921689987183
local_output_nid generation:  0.1692042350769043
local_in_edges_tensor generation:  0.713623046875
mini_batch_src_global generation:  1.1793665885925293
r_  generation:  10.838238954544067
local_output_nid generation:  0.20535564422607422
local_in_edges_tensor generation:  0.8080997467041016
mini_batch_src_global generation:  1.2011218070983887
r_  generation:  10.976268768310547
----------------------check_connections_block total spend ----------------------------- 234.96500396728516
generate_one_block  15.819104433059692
generate_one_block  14.980808734893799
generate_one_block  14.959881067276001
generate_one_block  15.262213468551636
generate_one_block  14.74140977859497
generate_one_block  14.929569721221924Using backend: pytorch

generate_one_block  15.177968263626099
generate_one_block  14.910505533218384
generate_one_block  16.033549308776855
generate_one_block  15.150785446166992
generate_one_block  15.278530359268188
generate_one_block  15.126960277557373
generate_one_block  14.988404989242554
generate_one_block  14.863755226135254
generate_one_block  15.236526489257812
generate_one_block  15.209434986114502
The real block id is  0
get_global_graph_edges_ids_block function  spend 3.3819456100463867
gen group dst list time:  1.1099770069122314
time for parepare:  0.49455952644348145
local_output_nid generation:  0.6353776454925537
local_in_edges_tensor generation:  1.941202163696289
mini_batch_src_global generation:  1.885260820388794
r_  generation:  23.406604766845703
local_output_nid generation:  0.6616580486297607
local_in_edges_tensor generation:  1.8616769313812256
mini_batch_src_global generation:  2.6477677822113037
r_  generation:  23.816187143325806
local_output_nid generation:  0.6575863361358643
local_in_edges_tensor generation:  1.9933183193206787
mini_batch_src_global generation:  2.6133105754852295
r_  generation:  23.798305988311768
local_output_nid generation:  0.6601970195770264
local_in_edges_tensor generation:  1.7951724529266357
mini_batch_src_global generation:  2.758695602416992
r_  generation:  23.98028802871704
local_output_nid generation:  0.6675333976745605
local_in_edges_tensor generation:  1.8139092922210693
mini_batch_src_global generation:  2.6162378787994385
r_  generation:  24.24085521697998
local_output_nid generation:  0.6544666290283203
local_in_edges_tensor generation:  3.2909927368164062
mini_batch_src_global generation:  2.523331880569458
r_  generation:  24.011558532714844
local_output_nid generation:  0.6738889217376709
local_in_edges_tensor generation:  1.8200509548187256
mini_batch_src_global generation:  2.707129955291748
r_  generation:  24.178931713104248
local_output_nid generation:  0.6517317295074463
local_in_edges_tensor generation:  1.8084526062011719
mini_batch_src_global generation:  2.605924367904663
r_  generation:  24.23345184326172
local_output_nid generation:  0.657214879989624
local_in_edges_tensor generation:  1.7891693115234375
mini_batch_src_global generation:  2.8828365802764893
r_  generation:  24.335313081741333
local_output_nid generation:  0.6495919227600098
local_in_edges_tensor generation:  1.8207478523254395
mini_batch_src_global generation:  2.7011568546295166
r_  generation:  24.141430377960205
local_output_nid generation:  0.6643705368041992
local_in_edges_tensor generation:  1.8182215690612793
mini_batch_src_global generation:  2.7559163570404053
r_  generation:  24.254161596298218
local_output_nid generation:  0.6566829681396484
local_in_edges_tensor generation:  1.800058126449585
mini_batch_src_global generation:  2.812805414199829
r_  generation:  24.064449787139893
local_output_nid generation:  0.6468937397003174
local_in_edges_tensor generation:  1.8022112846374512
mini_batch_src_global generation:  2.582566261291504
r_  generation:  24.320902109146118
local_output_nid generation:  0.6673636436462402
local_in_edges_tensor generation:  1.8138110637664795
mini_batch_src_global generation:  2.8135883808135986
r_  generation:  24.07547616958618
local_output_nid generation:  0.653679370880127
local_in_edges_tensor generation:  1.813692569732666
mini_batch_src_global generation:  2.6028521060943604
r_  generation:  24.784480094909668
local_output_nid generation:  0.6611146926879883
local_in_edges_tensor generation:  1.8164238929748535
mini_batch_src_global generation:  2.852816581726074
r_  generation:  24.19766902923584
----------------------check_connections_block total spend ----------------------------- 540.3379907608032
generate_one_block  33.168779134750366
generate_one_block  32.710718870162964
generate_one_block  32.86906313896179
generate_one_block  33.14592981338501
generate_one_block  32.96251463890076
generate_one_block  32.8397331237793
generate_one_block  33.995540380477905
generate_one_block  32.88024926185608
generate_one_block  33.15906071662903
generate_one_block  33.097309827804565
generate_one_block  32.90080809593201
generate_one_block  32.88980484008789
generate_one_block  32.91786527633667
generate_one_block  33.29075002670288
generate_one_block  33.17274022102356
generate_one_block  33.545145750045776
-----------------------------------------after block dataloader generation 
 Nvidia-smi: 2.0242919921875 GB
    Memory Allocated: 0.0006527900695800781  GigaBytes
Max Memory Allocated: 0.0006527900695800781  GigaBytes

connection checking time:  775.3029947280884
block generation total time  772.2154211997986
average batch blocks generation time:  48.26346382498741
----------------------------------------before batch_pred = model(blocks, batch_inputs) 
 Nvidia-smi: 3.6258544921875 GB
    Memory Allocated: 1.5206084251403809  GigaBytes
Max Memory Allocated: 1.5206084251403809  GigaBytes

Traceback (most recent call last):
  File "pseudo_mini_batch_range_products_sage.py", line 455, in <module>
    main()
  File "pseudo_mini_batch_range_products_sage.py", line 451, in main
    best_test = run(args, device, data)
  File "pseudo_mini_batch_range_products_sage.py", line 276, in run
    batch_pred = model(blocks, batch_inputs)#------------*
  File "/home/cc/.local/lib/python3.6/site-packages/torch/nn/modules/module.py", line 727, in _call_impl
    result = self.forward(*input, **kwargs)
  File "/home/cc/graph_partition_multi_layers/pseudo_mini_batch_full_batch/SAGE/graphsage_model_products.py", line 48, in forward
    x = layer(block, x)
  File "/home/cc/.local/lib/python3.6/site-packages/torch/nn/modules/module.py", line 727, in _call_impl
    result = self.forward(*input, **kwargs)
  File "/home/cc/.local/lib/python3.6/site-packages/dgl/nn/pytorch/conv/sageconv.py", line 258, in forward
    graph.update_all(msg_fn, self._lstm_reducer)
  File "/home/cc/.local/lib/python3.6/site-packages/dgl/heterograph.py", line 4849, in update_all
    ndata = core.message_passing(g, message_func, reduce_func, apply_node_func)
  File "/home/cc/.local/lib/python3.6/site-packages/dgl/core.py", line 327, in message_passing
    msgdata = invoke_gsddmm(g, mfunc)
  File "/home/cc/.local/lib/python3.6/site-packages/dgl/core.py", line 245, in invoke_gsddmm
    z = op(graph, x)
  File "/home/cc/.local/lib/python3.6/site-packages/dgl/ops/sddmm.py", line 169, in copy_u
    return gsddmm(g, 'copy_lhs', x, None)
  File "/home/cc/.local/lib/python3.6/site-packages/dgl/ops/sddmm.py", line 75, in gsddmm
    g._graph, op, lhs_data, rhs_data, lhs_target, rhs_target)
  File "/home/cc/.local/lib/python3.6/site-packages/dgl/backend/pytorch/sparse.py", line 512, in gsddmm
    return GSDDMM.apply(gidx, op, lhs_data, rhs_data, lhs_target, rhs_target)
  File "/home/cc/.local/lib/python3.6/site-packages/torch/cuda/amp/autocast_mode.py", line 213, in decorate_fwd
    return fwd(*args, **kwargs)
  File "/home/cc/.local/lib/python3.6/site-packages/dgl/backend/pytorch/sparse.py", line 256, in forward
    out = _gsddmm(gidx, op, X, Y, lhs_target, rhs_target)
  File "/home/cc/.local/lib/python3.6/site-packages/dgl/sparse.py", line 328, in _gsddmm
    out = F.zeros(out_shp, dtype, ctx)
  File "/home/cc/.local/lib/python3.6/site-packages/dgl/backend/pytorch/tensor.py", line 220, in zeros
    return th.zeros(shape, dtype=dtype, device=ctx)
RuntimeError: CUDA out of memory. Tried to allocate 22.95 GiB (GPU 0; 23.62 GiB total capacity; 1.52 GiB already allocated; 20.00 GiB free; 1.54 GiB reserved in total by PyTorch)
