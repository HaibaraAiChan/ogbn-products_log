main start at this time 1648183857.0279748
#nodes: 2449029
#edges: 123718024
#classes: 47
success----------------------------------------
196571
39255
2164782
# Nodes: 2400608
# Edges: 123718024
# Train: 196571
# Val: 39255
# Test: 2164782
# Classes: 47

in feats:  100
----------------------------------------before generate_dataloader_block 
 Nvidia-smi: 2.0242919921875 GB
    Memory Allocated: 0.0006527900695800781  GigaBytes
Max Memory Allocated: 0.0006527900695800781  GigaBytes

The real block id is  2
get_global_graph_edges_ids_block function  spend 0.43646955490112305
random selection method range initialization spend 0.016900300979614258
time for parepare:  0.28902578353881836
local_output_nid generation:  0.006334781646728516
local_in_edges_tensor generation:  0.026463747024536133
mini_batch_src_global generation:  0.01669597625732422
r_  generation:  0.18539190292358398
local_output_nid generation:  0.007211923599243164
local_in_edges_tensor generation:  0.006509304046630859
mini_batch_src_global generation:  0.02120494842529297
r_  generation:  0.20584321022033691
local_output_nid generation:  0.0071713924407958984
local_in_edges_tensor generation:  0.006541013717651367
mini_batch_src_global generation:  0.014766216278076172
r_  generation:  0.21657252311706543
local_output_nid generation:  0.007250785827636719
local_in_edges_tensor generation:  0.006468772888183594
mini_batch_src_global generation:  0.01580023765563965
r_  generation:  0.30898189544677734
local_output_nid generation:  0.010039567947387695
local_in_edges_tensor generation:  0.00989985466003418
mini_batch_src_global generation:  0.018560409545898438
r_  generation:  0.2361760139465332
local_output_nid generation:  0.007219076156616211
local_in_edges_tensor generation:  0.006862163543701172
mini_batch_src_global generation:  0.015721797943115234
r_  generation:  0.24683165550231934
local_output_nid generation:  0.0072672367095947266
local_in_edges_tensor generation:  0.006528377532958984
mini_batch_src_global generation:  0.01659679412841797
r_  generation:  0.25896739959716797
local_output_nid generation:  0.007105350494384766
local_in_edges_tensor generation:  0.0064084529876708984
mini_batch_src_global generation:  0.017055034637451172
r_  generation:  0.26096653938293457
local_output_nid generation:  0.0070879459381103516
local_in_edges_tensor generation:  0.0064814090728759766
mini_batch_src_global generation:  0.018073558807373047
r_  generation:  0.2698338031768799
local_output_nid generation:  0.007130622863769531
local_in_edges_tensor generation:  0.007315635681152344
mini_batch_src_global generation:  0.01901721954345703
r_  generation:  0.27385592460632324
local_output_nid generation:  0.007094860076904297
local_in_edges_tensor generation:  0.010523796081542969
mini_batch_src_global generation:  0.01943373680114746
r_  generation:  0.2810075283050537
local_output_nid generation:  0.007114887237548828
local_in_edges_tensor generation:  0.006483316421508789
mini_batch_src_global generation:  0.019921302795410156
r_  generation:  0.27899169921875
local_output_nid generation:  0.0071256160736083984
local_in_edges_tensor generation:  0.006564617156982422
mini_batch_src_global generation:  0.020565509796142578
r_  generation:  0.27747464179992676
local_output_nid generation:  0.0071163177490234375
local_in_edges_tensor generation:  0.006502866744995117
mini_batch_src_global generation:  0.020750999450683594
r_  generation:  0.28731822967529297
local_output_nid generation:  0.00713658332824707
local_in_edges_tensor generation:  0.026508331298828125
mini_batch_src_global generation:  0.020850419998168945
r_  generation:  0.2815437316894531
local_output_nid generation:  0.007103919982910156
local_in_edges_tensor generation:  0.012384176254272461
mini_batch_src_global generation:  0.021614551544189453
r_  generation:  0.2948169708251953
----------------------check_connections_block total spend ----------------------------- 5.85979151725769
generate_one_block  6.357474088668823
generate_one_block  0.3252410888671875
generate_one_block  0.3402097225189209
generate_one_block  0.33266520500183105
generate_one_block  0.3271522521972656
generate_one_block  0.28728771209716797
generate_one_block  0.32716822624206543
generate_one_block  0.3271920680999756
generate_one_block  0.32573533058166504
generate_one_block  0.3030085563659668
generate_one_block  0.2980155944824219
generate_one_block  0.2902870178222656
generate_one_block  0.28000974655151367
generate_one_block  0.2802925109863281
generate_one_block  0.27703285217285156
generate_one_block  0.2759377956390381
The real block id is  1
get_global_graph_edges_ids_block function  spend 2.0439937114715576
gen group dst list time:  0.14734506607055664
time for parepare:  0.4393956661224365
local_output_nid generation:  0.10448312759399414
local_in_edges_tensor generation:  0.3530895709991455
mini_batch_src_global generation:  0.33540964126586914
r_  generation:  4.478135108947754
local_output_nid generation:  0.10548210144042969
local_in_edges_tensor generation:  0.280916690826416
mini_batch_src_global generation:  0.44739603996276855
r_  generation:  4.614522457122803
local_output_nid generation:  0.10616254806518555
local_in_edges_tensor generation:  0.28119492530822754
mini_batch_src_global generation:  0.41651463508605957
r_  generation:  4.722128629684448
local_output_nid generation:  0.10627031326293945
local_in_edges_tensor generation:  0.28676342964172363
mini_batch_src_global generation:  0.4310135841369629
r_  generation:  4.839725017547607
local_output_nid generation:  0.11193513870239258
local_in_edges_tensor generation:  0.39228010177612305
mini_batch_src_global generation:  0.44495129585266113
r_  generation:  4.869410037994385
local_output_nid generation:  0.11810088157653809
local_in_edges_tensor generation:  0.30306529998779297
mini_batch_src_global generation:  0.454028844833374
r_  generation:  4.932166337966919
local_output_nid generation:  0.10808873176574707
local_in_edges_tensor generation:  0.29224467277526855
mini_batch_src_global generation:  0.5014762878417969
r_  generation:  5.008837461471558
local_output_nid generation:  0.10799145698547363
local_in_edges_tensor generation:  0.3343970775604248
mini_batch_src_global generation:  0.4669668674468994
r_  generation:  4.979429483413696
local_output_nid generation:  0.1345977783203125
local_in_edges_tensor generation:  0.43834376335144043
mini_batch_src_global generation:  0.46485280990600586
r_  generation:  4.935910701751709
local_output_nid generation:  0.11152982711791992
local_in_edges_tensor generation:  0.30060291290283203
mini_batch_src_global generation:  0.4818706512451172
r_  generation:  5.041784286499023
local_output_nid generation:  0.1076192855834961
local_in_edges_tensor generation:  0.2824723720550537
mini_batch_src_global generation:  0.481597900390625
r_  generation:  5.022562265396118
local_output_nid generation:  0.13413405418395996
local_in_edges_tensor generation:  0.40027308464050293
mini_batch_src_global generation:  0.4685242176055908
r_  generation:  4.98374605178833
local_output_nid generation:  0.10883450508117676
local_in_edges_tensor generation:  0.29271960258483887
mini_batch_src_global generation:  0.47330641746520996
r_  generation:  5.044376850128174
local_output_nid generation:  0.10801410675048828
local_in_edges_tensor generation:  0.2829015254974365
mini_batch_src_global generation:  0.47427892684936523
r_  generation:  5.067974805831909
local_output_nid generation:  0.10858035087585449
local_in_edges_tensor generation:  0.38298892974853516
mini_batch_src_global generation:  0.4701063632965088
r_  generation:  4.994677782058716
local_output_nid generation:  0.12630438804626465
local_in_edges_tensor generation:  0.2950408458709717
mini_batch_src_global generation:  0.4739108085632324
r_  generation:  5.034790277481079
----------------------check_connections_block total spend ----------------------------- 106.21910881996155
generate_one_block  6.7733118534088135
generate_one_block  6.365113019943237
generate_one_block  6.140313148498535
generate_one_block  6.07743763923645
generate_one_block  6.014752149581909
generate_one_block Using backend: pytorch
 6.381317377090454
generate_one_block  6.124779939651489
generate_one_block  6.0603156089782715
generate_one_block  6.155917406082153
generate_one_block  6.206817626953125
generate_one_block  6.278478145599365
generate_one_block  6.036511421203613
generate_one_block  6.0455780029296875
generate_one_block  6.195783615112305
generate_one_block  6.2712562084198
generate_one_block  6.059399604797363
The real block id is  0
get_global_graph_edges_ids_block function  spend 2.1782119274139404
gen group dst list time:  0.8792390823364258
time for parepare:  0.5045669078826904
local_output_nid generation:  0.534153938293457
local_in_edges_tensor generation:  1.2575929164886475
mini_batch_src_global generation:  1.0127809047698975
r_  generation:  13.773897171020508
local_output_nid generation:  0.554243803024292
local_in_edges_tensor generation:  1.1566410064697266
mini_batch_src_global generation:  1.3849499225616455
r_  generation:  13.80738615989685
local_output_nid generation:  0.5592310428619385
local_in_edges_tensor generation:  1.156853199005127
mini_batch_src_global generation:  1.3919813632965088
r_  generation:  14.112263679504395
local_output_nid generation:  0.5592854022979736
local_in_edges_tensor generation:  1.1922357082366943
mini_batch_src_global generation:  1.3993375301361084
r_  generation:  16.041295528411865
local_output_nid generation:  0.5653533935546875
local_in_edges_tensor generation:  1.150094747543335
mini_batch_src_global generation:  1.6271629333496094
r_  generation:  14.318959712982178
local_output_nid generation:  0.5426812171936035
local_in_edges_tensor generation:  2.105741262435913
mini_batch_src_global generation:  1.3663969039916992
r_  generation:  14.129979848861694
local_output_nid generation:  0.5626986026763916
local_in_edges_tensor generation:  1.0794262886047363
mini_batch_src_global generation:  1.3461711406707764
r_  generation:  14.359613180160522
local_output_nid generation:  0.5234768390655518
local_in_edges_tensor generation:  1.130880355834961
mini_batch_src_global generation:  1.3536098003387451
r_  generation:  14.33970832824707
local_output_nid generation:  0.5260059833526611
local_in_edges_tensor generation:  1.0774178504943848
mini_batch_src_global generation:  1.3882641792297363
r_  generation:  14.164069175720215
local_output_nid generation:  0.5572843551635742
local_in_edges_tensor generation:  1.0765380859375
mini_batch_src_global generation:  1.3630938529968262
r_  generation:  14.325540542602539
local_output_nid generation:  0.5628056526184082
local_in_edges_tensor generation:  1.1158781051635742
mini_batch_src_global generation:  1.32265305519104
r_  generation:  14.331329584121704
local_output_nid generation:  0.5113325119018555
local_in_edges_tensor generation:  1.072540283203125
mini_batch_src_global generation:  1.443018913269043
r_  generation:  14.13841986656189
local_output_nid generation:  0.5611007213592529
local_in_edges_tensor generation:  1.0810556411743164
mini_batch_src_global generation:  1.4529190063476562
r_  generation:  14.299813032150269
local_output_nid generation:  0.5529232025146484
local_in_edges_tensor generation:  1.126391887664795
mini_batch_src_global generation:  1.3208565711975098
r_  generation:  14.423817873001099
local_output_nid generation:  0.525456428527832
local_in_edges_tensor generation:  1.1357436180114746
mini_batch_src_global generation:  1.3610599040985107
r_  generation:  14.346324443817139
local_output_nid generation:  0.5497241020202637
local_in_edges_tensor generation:  1.0822584629058838
mini_batch_src_global generation:  1.3720440864562988
r_  generation:  14.201778650283813
----------------------check_connections_block total spend ----------------------------- 320.1723153591156
generate_one_block  18.934348821640015
generate_one_block  18.896789073944092
generate_one_block  19.005580186843872
generate_one_block  18.980781316757202
generate_one_block  18.882078170776367
generate_one_block  18.980395555496216
generate_one_block  19.79352617263794
generate_one_block  19.086228609085083
generate_one_block  19.07775092124939
generate_one_block  18.704566955566406
generate_one_block  18.706696033477783
generate_one_block  18.856877088546753
generate_one_block  18.844133615493774
generate_one_block  18.88624882698059
generate_one_block  19.007420778274536
generate_one_block  19.210845232009888
-----------------------------------------after block dataloader generation 
 Nvidia-smi: 2.0242919921875 GB
    Memory Allocated: 0.0006527900695800781  GigaBytes
Max Memory Allocated: 0.0006527900695800781  GigaBytes

connection checking time:  426.39142417907715
block generation total time  403.0413501262665
average batch blocks generation time:  25.190084382891655
----------------------------------------before batch_pred = model(blocks, batch_inputs) 
 Nvidia-smi: 3.2156982421875 GB
    Memory Allocated: 1.1263651847839355  GigaBytes
Max Memory Allocated: 1.1263651847839355  GigaBytes

Traceback (most recent call last):
  File "pseudo_mini_batch_range_products_sage.py", line 455, in <module>
    main()
  File "pseudo_mini_batch_range_products_sage.py", line 451, in main
    best_test = run(args, device, data)
  File "pseudo_mini_batch_range_products_sage.py", line 276, in run
    batch_pred = model(blocks, batch_inputs)#------------*
  File "/home/cc/.local/lib/python3.6/site-packages/torch/nn/modules/module.py", line 727, in _call_impl
    result = self.forward(*input, **kwargs)
  File "/home/cc/graph_partition_multi_layers/pseudo_mini_batch_full_batch/SAGE/graphsage_model_products.py", line 48, in forward
    x = layer(block, x)
  File "/home/cc/.local/lib/python3.6/site-packages/torch/nn/modules/module.py", line 727, in _call_impl
    result = self.forward(*input, **kwargs)
  File "/home/cc/.local/lib/python3.6/site-packages/dgl/nn/pytorch/conv/sageconv.py", line 258, in forward
    graph.update_all(msg_fn, self._lstm_reducer)
  File "/home/cc/.local/lib/python3.6/site-packages/dgl/heterograph.py", line 4849, in update_all
    ndata = core.message_passing(g, message_func, reduce_func, apply_node_func)
  File "/home/cc/.local/lib/python3.6/site-packages/dgl/core.py", line 337, in message_passing
    ndata = invoke_udf_reduce(g, rfunc, msgdata, orig_nid=orig_nid)
  File "/home/cc/.local/lib/python3.6/site-packages/dgl/core.py", line 143, in invoke_udf_reduce
    bkt_rsts.append(func(nbatch))
  File "/home/cc/.local/lib/python3.6/site-packages/dgl/nn/pytorch/conv/sageconv.py", line 173, in _lstm_reducer
    _, (rst, _) = self.lstm(m, h)
  File "/home/cc/.local/lib/python3.6/site-packages/torch/nn/modules/module.py", line 727, in _call_impl
    result = self.forward(*input, **kwargs)
  File "/home/cc/.local/lib/python3.6/site-packages/torch/nn/modules/rnn.py", line 582, in forward
    self.dropout, self.training, self.bidirectional, self.batch_first)
RuntimeError: CUDA out of memory. Tried to allocate 36.00 MiB (GPU 0; 23.62 GiB total capacity; 20.75 GiB already allocated; 5.44 MiB free; 21.06 GiB reserved in total by PyTorch)
