Using backend: pytorch
main start at this time 1648195370.7789881
#nodes: 2449029
#edges: 123718024
#classes: 47
success----------------------------------------
196571
39255
2164782
# Nodes: 2400608
# Edges: 123718024
# Train: 196571
# Val: 39255
# Test: 2164782
# Classes: 47

in feats:  100
----------------------------------------before generate_dataloader_block 
 Nvidia-smi: 2.0242919921875 GB
    Memory Allocated: 0.0006527900695800781  GigaBytes
Max Memory Allocated: 0.0006527900695800781  GigaBytes

The real block id is  2
get_global_graph_edges_ids_block function  spend 0.6299948692321777
random selection method range initialization spend 0.023713111877441406
time for parepare:  0.3750336170196533
local_output_nid generation:  0.013411521911621094
local_in_edges_tensor generation:  0.051287174224853516
mini_batch_src_global generation:  0.04888629913330078
r_  generation:  0.8000593185424805
local_output_nid generation:  0.013880729675292969
local_in_edges_tensor generation:  0.03219437599182129
mini_batch_src_global generation:  0.06977534294128418
r_  generation:  0.8725306987762451
local_output_nid generation:  0.0137481689453125
local_in_edges_tensor generation:  0.021848440170288086
mini_batch_src_global generation:  0.0479121208190918
r_  generation:  0.89034104347229
local_output_nid generation:  0.013790130615234375
local_in_edges_tensor generation:  0.023730754852294922
mini_batch_src_global generation:  0.059647321701049805
r_  generation:  0.9705803394317627
local_output_nid generation:  0.013766288757324219
local_in_edges_tensor generation:  0.018560171127319336
mini_batch_src_global generation:  0.061652421951293945
r_  generation:  1.0065765380859375
local_output_nid generation:  0.013713836669921875
local_in_edges_tensor generation:  0.037615060806274414
mini_batch_src_global generation:  0.06772541999816895
r_  generation:  1.0465233325958252
local_output_nid generation:  0.01374197006225586
local_in_edges_tensor generation:  0.026696443557739258
mini_batch_src_global generation:  0.07067561149597168
r_  generation:  1.0571117401123047
local_output_nid generation:  0.013699531555175781
local_in_edges_tensor generation:  0.028011798858642578
mini_batch_src_global generation:  0.07126331329345703
r_  generation:  1.0557682514190674
----------------------check_connections_block total spend ----------------------------- 10.10876727104187
generate_one_block  6.060322046279907
generate_one_block  1.012894630432129
generate_one_block  1.0027048587799072
generate_one_block  1.0168967247009277
generate_one_block  1.0107579231262207
generate_one_block  1.0030574798583984
generate_one_block  1.018085241317749
generate_one_block  0.9996819496154785
The real block id is  1
get_global_graph_edges_ids_block function  spend 2.396556854248047
gen group dst list time:  0.18036341667175293
time for parepare:  0.4382789134979248
local_output_nid generation:  0.23702383041381836
local_in_edges_tensor generation:  0.7557041645050049
mini_batch_src_global generation:  0.7487795352935791
r_  generation:  9.469068050384521
local_output_nid generation:  0.2451024055480957
local_in_edges_tensor generation:  0.6489641666412354
mini_batch_src_global generation:  0.9672625064849854
r_  generation:  9.711141109466553
local_output_nid generation:  0.24430155754089355
local_in_edges_tensor generation:  0.709644079208374
mini_batch_src_global generation:  0.9265749454498291
r_  generation:  9.79875111579895
local_output_nid generation:  0.29130983352661133
local_in_edges_tensor generation:  0.7131843566894531
mini_batch_src_global generation:  0.9528720378875732
r_  generation:  9.995477676391602
local_output_nid generation:  0.24837255477905273
local_in_edges_tensor generation:  0.6541051864624023
mini_batch_src_global generation:  1.1109836101531982
r_  generation:  10.821452856063843
local_output_nid generation:  0.2975482940673828
local_in_edges_tensor generation:  1.00189208984375
mini_batch_src_global generation:  1.0765793323516846
r_  generation:  10.232664108276367
local_output_nid generation:  0.27562475204467773
local_in_edges_tensor generation:  0.6781811714172363
mini_batch_src_global generation:  1.062192678451538
r_  generation:  10.32857084274292
local_output_nid generation:  0.28546762466430664
local_in_edges_tensor generation:  0.7798831462860107
mini_batch_src_global generation:  0.9871571063995361
r_  generation:  10.198841094970703
----------------------check_connections_block total spend ----------------------------- 110.7877287864685
generate_one_block  13.862596035003662
generate_one_block  13.892457485198975
generate_one_block  13.735382318496704
generate_one_block  13.708238124847412
generate_one_block  13.427531957626343
generate_one_block  13.636327266693115
generate_one_block  13.395547866821289
generate_one_block  13.827485084533691
The real block id is  0
get_global_graph_edges_ids_block function  spend 2.1094725131988525
gen group dst list time:  0.568591833114624
time for parepare:  0.47238850593566895
local_output_nid generation:  0.6138050556182861
local_in_edges_tensor generation:  1.3824870586395264
mini_batch_src_global generation:  1.173048973083496
r_  generation:  15.89782190322876
local_output_nid generation:  0.6842250823974609
local_in_edges_tensor generation:  1.2086882591247559
mini_batch_src_global generation:  1.652284860610962
r_  generation:  16.994927644729614
local_output_nid generation:  0.7025740146636963
local_in_edges_tensor generation:  1.3526833057403564
mini_batch_src_global generation:  1.5794286727905273
r_  generation:  16.333656311035156
local_output_nid generation:  0.6603970527648926
local_in_edges_tensor generation:  1.5116407871246338
mini_batch_src_global generation:  1.661616563796997
r_  generation:  16.35136103630066
local_output_nid generation:  0.673457145690918
local_in_edges_tensor generation:  1.1881599426269531
mini_batch_src_global generation:  1.6404592990875244
r_  generation:  16.50556230545044
local_output_nid generation:  0.6811714172363281
local_in_edges_tensor generation:  1.2792136669158936
mini_batch_src_global generation:  1.6732995510101318
r_  generation:  16.422959804534912
local_output_nid generation:  0.6869962215423584
local_in_edges_tensor generation:  1.2885220050811768
mini_batch_src_global generation:  1.6995034217834473
r_  generation:  16.708688020706177
local_output_nid generation:  0.6853623390197754
local_in_edges_tensor generation:  1.3080856800079346
mini_batch_src_global generation:  1.5860505104064941
r_  generation:  16.818957805633545
----------------------check_connections_block total spend ----------------------------- 184.92936754226685
generate_one_block  21.99712109565735
generate_one_block  22.783669471740723
generate_one_block  21.824265718460083
generate_one_block  21.856322288513184
generate_one_block  21.9421443939209
generate_one_block  21.8374662399292
generate_one_block  21.9381103515625
generate_one_block  22.066632747650146
-----------------------------------------after block dataloader generation 
 Nvidia-smi: 2.0242919921875 GB
    Memory Allocated: 0.0006527900695800781  GigaBytes
Max Memory Allocated: 0.0006527900695800781  GigaBytes

connection checking time:  295.71709632873535
block generation total time  285.7312984466553
average batch blocks generation time:  35.71641230583191
----------------------------------------before batch_pred = model(blocks, batch_inputs) 
 Nvidia-smi: 3.4031982421875 GB
    Memory Allocated: 1.3041763305664062  GigaBytes
Max Memory Allocated: 1.3041763305664062  GigaBytes

Traceback (most recent call last):
  File "pseudo_mini_batch_range_products_sage.py", line 455, in <module>
    main()
  File "pseudo_mini_batch_range_products_sage.py", line 451, in main
    best_test = run(args, device, data)
  File "pseudo_mini_batch_range_products_sage.py", line 276, in run
    batch_pred = model(blocks, batch_inputs)#------------*
  File "/home/cc/.local/lib/python3.6/site-packages/torch/nn/modules/module.py", line 727, in _call_impl
    result = self.forward(*input, **kwargs)
  File "/home/cc/graph_partition_multi_layers/pseudo_mini_batch_full_batch/SAGE/graphsage_model_products.py", line 48, in forward
    x = layer(block, x)
  File "/home/cc/.local/lib/python3.6/site-packages/torch/nn/modules/module.py", line 727, in _call_impl
    result = self.forward(*input, **kwargs)
  File "/home/cc/.local/lib/python3.6/site-packages/dgl/nn/pytorch/conv/sageconv.py", line 258, in forward
    graph.update_all(msg_fn, self._lstm_reducer)
  File "/home/cc/.local/lib/python3.6/site-packages/dgl/heterograph.py", line 4849, in update_all
    ndata = core.message_passing(g, message_func, reduce_func, apply_node_func)
  File "/home/cc/.local/lib/python3.6/site-packages/dgl/core.py", line 337, in message_passing
    ndata = invoke_udf_reduce(g, rfunc, msgdata, orig_nid=orig_nid)
  File "/home/cc/.local/lib/python3.6/site-packages/dgl/core.py", line 143, in invoke_udf_reduce
    bkt_rsts.append(func(nbatch))
  File "/home/cc/.local/lib/python3.6/site-packages/dgl/nn/pytorch/conv/sageconv.py", line 173, in _lstm_reducer
    _, (rst, _) = self.lstm(m, h)
  File "/home/cc/.local/lib/python3.6/site-packages/torch/nn/modules/module.py", line 727, in _call_impl
    result = self.forward(*input, **kwargs)
  File "/home/cc/.local/lib/python3.6/site-packages/torch/nn/modules/rnn.py", line 582, in forward
    self.dropout, self.training, self.bidirectional, self.batch_first)
RuntimeError: CUDA out of memory. Tried to allocate 60.00 MiB (GPU 0; 23.62 GiB total capacity; 20.87 GiB already allocated; 23.44 MiB free; 20.99 GiB reserved in total by PyTorch)
