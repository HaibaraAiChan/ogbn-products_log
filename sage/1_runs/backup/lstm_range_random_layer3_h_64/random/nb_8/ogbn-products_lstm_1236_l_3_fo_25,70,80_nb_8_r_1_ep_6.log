Using backend: pytorch
main start at this time 1648210821.7447863
#nodes: 2449029
#edges: 123718024
#classes: 47
success----------------------------------------
196571
39255
2164782
# Nodes: 2400608
# Edges: 123718024
# Train: 196571
# Val: 39255
# Test: 2164782
# Classes: 47

in feats:  100
----------------------------------------before generate_dataloader_block 
 Nvidia-smi: 2.0242919921875 GB
    Memory Allocated: 0.0006527900695800781  GigaBytes
Max Memory Allocated: 0.0006527900695800781  GigaBytes

The real block id is  2
get_global_graph_edges_ids_block function  spend 0.6797442436218262
random selection method range initialization spend 0.02140069007873535
time for parepare:  0.37384796142578125
local_output_nid generation:  0.01342916488647461
local_in_edges_tensor generation:  0.051506996154785156
mini_batch_src_global generation:  0.05105900764465332
r_  generation:  0.7975468635559082
local_output_nid generation:  0.013685226440429688
local_in_edges_tensor generation:  0.03380250930786133
mini_batch_src_global generation:  0.07200002670288086
r_  generation:  0.8804376125335693
local_output_nid generation:  0.013618230819702148
local_in_edges_tensor generation:  0.023308515548706055
mini_batch_src_global generation:  0.048894643783569336
r_  generation:  0.8869531154632568
local_output_nid generation:  0.013657331466674805
local_in_edges_tensor generation:  0.025246620178222656
mini_batch_src_global generation:  0.060717105865478516
r_  generation:  0.9749717712402344
local_output_nid generation:  0.013855695724487305
local_in_edges_tensor generation:  0.02040886878967285
mini_batch_src_global generation:  0.06298828125
r_  generation:  1.0065984725952148
local_output_nid generation:  0.013570070266723633
local_in_edges_tensor generation:  0.03910017013549805
mini_batch_src_global generation:  0.0694434642791748
r_  generation:  1.0446064472198486
local_output_nid generation:  0.01359105110168457
local_in_edges_tensor generation:  0.027900218963623047
mini_batch_src_global generation:  0.07188677787780762
r_  generation:  1.054248332977295
local_output_nid generation:  0.013612031936645508
local_in_edges_tensor generation:  0.02923583984375
mini_batch_src_global generation:  0.07266473770141602
r_  generation:  1.052372932434082
----------------------check_connections_block total spend ----------------------------- 10.138103008270264
generate_one_block  6.094349384307861
generate_one_block  1.015967845916748
generate_one_block  1.0463383197784424
generate_one_block  1.012270212173462
generate_one_block  1.0612998008728027
generate_one_block  1.0102198123931885
generate_one_block  1.0688793659210205
generate_one_block  1.0427703857421875
The real block id is  1
get_global_graph_edges_ids_block function  spend 3.8507437705993652
gen group dst list time:  0.19871878623962402
time for parepare:  0.4882795810699463
local_output_nid generation:  0.25171470642089844
local_in_edges_tensor generation:  1.0955026149749756
mini_batch_src_global generation:  1.2505300045013428
r_  generation:  15.233136653900146
local_output_nid generation:  0.28638648986816406
local_in_edges_tensor generation:  1.2426636219024658
mini_batch_src_global generation:  1.6323397159576416
r_  generation:  15.169071435928345
local_output_nid generation:  0.27922964096069336
local_in_edges_tensor generation:  1.4873335361480713
mini_batch_src_global generation:  1.5471765995025635
r_  generation:  15.30997610092163
local_output_nid generation:  0.2496953010559082
local_in_edges_tensor generation:  1.1377372741699219
mini_batch_src_global generation:  1.656630277633667
r_  generation:  15.33378529548645
local_output_nid generation:  0.2699298858642578
local_in_edges_tensor generation:  0.9341332912445068
mini_batch_src_global generation:  1.7172906398773193
r_  generation:  15.441063404083252
local_output_nid generation:  0.2885901927947998
local_in_edges_tensor generation:  1.1278975009918213
mini_batch_src_global generation:  1.6859638690948486
r_  generation:  15.668255805969238
local_output_nid generation:  0.2830832004547119
local_in_edges_tensor generation:  1.122040033340454
mini_batch_src_global generation:  1.6040306091308594
r_  generation:  15.590964078903198
local_output_nid generation:  0.26244616508483887
local_in_edges_tensor generation:  1.1369256973266602
mini_batch_src_global generation:  1.7266936302185059
r_  generation:  15.546043634414673
----------------------check_connections_block total spend ----------------------------- 169.33284664154053
generate_one_block  21.72774910926819
generate_one_block  21.58524775505066
generate_one_block  21.81647276878357
generate_one_block  21.687987327575684
generate_one_block  21.671082735061646
generate_one_block  21.46604585647583
generate_one_block  21.592462062835693
generate_one_block  21.57981276512146
The real block id is  0
get_global_graph_edges_ids_block function  spend 2.1349942684173584
gen group dst list time:  0.6356914043426514
time for parepare:  0.48848676681518555
local_output_nid generation:  0.6854655742645264
local_in_edges_tensor generation:  1.5471787452697754
mini_batch_src_global generation:  1.2134950160980225
r_  generation:  16.96101665496826
local_output_nid generation:  0.829054594039917
local_in_edges_tensor generation:  1.5339572429656982
mini_batch_src_global generation:  1.6694543361663818
r_  generation:  16.881017923355103
local_output_nid generation:  0.6907367706298828
local_in_edges_tensor generation:  1.3685002326965332
mini_batch_src_global generation:  1.5794432163238525
r_  generation:  17.180082321166992
local_output_nid generation:  0.6820709705352783
local_in_edges_tensor generation:  1.3526270389556885
mini_batch_src_global generation:  1.6905710697174072
r_  generation:  17.217737674713135
local_output_nid generation:  0.6897821426391602
local_in_edges_tensor generation:  1.3495984077453613
mini_batch_src_global generation:  1.6414501667022705
r_  generation:  17.36045527458191
local_output_nid generation:  0.7007620334625244
local_in_edges_tensor generation:  1.377152681350708
mini_batch_src_global generation:  1.7106356620788574
r_  generation:  17.345869302749634
local_output_nid generation:  0.6954107284545898
local_in_edges_tensor generation:  1.364250659942627
mini_batch_src_global generation:  1.6487336158752441
r_  generation:  17.550021409988403
local_output_nid generation:  0.7100546360015869
local_in_edges_tensor generation:  1.3716886043548584
mini_batch_src_global generation:  1.7207715511322021
r_  generation:  17.4830162525177
----------------------check_connections_block total spend ----------------------------- 193.25435543060303
generate_one_block  22.712687492370605
generate_one_block  23.647132873535156
generate_one_block  22.65772271156311
generate_one_block  22.658064603805542
generate_one_block  22.506513833999634
generate_one_block  22.424001216888428
generate_one_block  22.536115884780884
generate_one_block  22.656312942504883
-----------------------------------------after block dataloader generation 
 Nvidia-smi: 2.0242919921875 GB
    Memory Allocated: 0.0006527900695800781  GigaBytes
Max Memory Allocated: 0.0006527900695800781  GigaBytes

connection checking time:  362.58720207214355
block generation total time  354.925411939621
average batch blocks generation time:  44.36567649245262
----------------------------------------before batch_pred = model(blocks, batch_inputs) 
 Nvidia-smi: 3.5496826171875 GB
    Memory Allocated: 1.4511003494262695  GigaBytes
Max Memory Allocated: 1.4511003494262695  GigaBytes

Traceback (most recent call last):
  File "pseudo_mini_batch_range_products_sage.py", line 455, in <module>
    main()
  File "pseudo_mini_batch_range_products_sage.py", line 451, in main
    best_test = run(args, device, data)
  File "pseudo_mini_batch_range_products_sage.py", line 276, in run
    batch_pred = model(blocks, batch_inputs)#------------*
  File "/home/cc/.local/lib/python3.6/site-packages/torch/nn/modules/module.py", line 727, in _call_impl
    result = self.forward(*input, **kwargs)
  File "/home/cc/graph_partition_multi_layers/pseudo_mini_batch_full_batch/SAGE/graphsage_model_products.py", line 48, in forward
    x = layer(block, x)
  File "/home/cc/.local/lib/python3.6/site-packages/torch/nn/modules/module.py", line 727, in _call_impl
    result = self.forward(*input, **kwargs)
  File "/home/cc/.local/lib/python3.6/site-packages/dgl/nn/pytorch/conv/sageconv.py", line 258, in forward
    graph.update_all(msg_fn, self._lstm_reducer)
  File "/home/cc/.local/lib/python3.6/site-packages/dgl/heterograph.py", line 4849, in update_all
    ndata = core.message_passing(g, message_func, reduce_func, apply_node_func)
  File "/home/cc/.local/lib/python3.6/site-packages/dgl/core.py", line 337, in message_passing
    ndata = invoke_udf_reduce(g, rfunc, msgdata, orig_nid=orig_nid)
  File "/home/cc/.local/lib/python3.6/site-packages/dgl/core.py", line 143, in invoke_udf_reduce
    bkt_rsts.append(func(nbatch))
  File "/home/cc/.local/lib/python3.6/site-packages/dgl/nn/pytorch/conv/sageconv.py", line 173, in _lstm_reducer
    _, (rst, _) = self.lstm(m, h)
  File "/home/cc/.local/lib/python3.6/site-packages/torch/nn/modules/module.py", line 727, in _call_impl
    result = self.forward(*input, **kwargs)
  File "/home/cc/.local/lib/python3.6/site-packages/torch/nn/modules/rnn.py", line 582, in forward
    self.dropout, self.training, self.bidirectional, self.batch_first)
RuntimeError: CUDA out of memory. Tried to allocate 70.00 MiB (GPU 0; 23.62 GiB total capacity; 20.84 GiB already allocated; 57.44 MiB free; 20.94 GiB reserved in total by PyTorch)
