Using backend: pytorch
main start at this time 1648183254.750501
#nodes: 2449029
#edges: 123718024
#classes: 47
success----------------------------------------
196571
39255
2164782
# Nodes: 2400608
# Edges: 123718024
# Train: 196571
# Val: 39255
# Test: 2164782
# Classes: 47

in feats:  100
----------------------------------------before generate_dataloader_block 
 Nvidia-smi: 2.0242919921875 GB
    Memory Allocated: 0.0006527900695800781  GigaBytes
Max Memory Allocated: 0.0006527900695800781  GigaBytes

The real block id is  2
get_global_graph_edges_ids_block function  spend 0.41697072982788086
random selection method range initialization spend 0.017275571823120117
time for parepare:  0.27440309524536133
local_output_nid generation:  0.012446165084838867
local_in_edges_tensor generation:  0.03847336769104004
mini_batch_src_global generation:  0.02942943572998047
r_  generation:  0.4044911861419678
local_output_nid generation:  0.013845682144165039
local_in_edges_tensor generation:  0.01996302604675293
mini_batch_src_global generation:  0.04184985160827637
r_  generation:  0.4580376148223877
local_output_nid generation:  0.013674497604370117
local_in_edges_tensor generation:  0.03219270706176758
mini_batch_src_global generation:  0.033885955810546875
r_  generation:  0.4809236526489258
local_output_nid generation:  0.013736248016357422
local_in_edges_tensor generation:  0.019373655319213867
mini_batch_src_global generation:  0.031955718994140625
r_  generation:  0.519157886505127
local_output_nid generation:  0.013606548309326172
local_in_edges_tensor generation:  0.013246297836303711
mini_batch_src_global generation:  0.0340118408203125
r_  generation:  0.5347938537597656
local_output_nid generation:  0.013645172119140625
local_in_edges_tensor generation:  0.012117862701416016
mini_batch_src_global generation:  0.036188364028930664
r_  generation:  0.566352128982544
local_output_nid generation:  0.014711618423461914
local_in_edges_tensor generation:  0.035659074783325195
mini_batch_src_global generation:  0.03747296333312988
r_  generation:  0.5749709606170654
local_output_nid generation:  0.01359105110168457
local_in_edges_tensor generation:  0.015733003616333008
mini_batch_src_global generation:  0.03874921798706055
r_  generation:  0.5715539455413818
----------------------check_connections_block total spend ----------------------------- 5.690893650054932
generate_one_block  6.089737176895142
generate_one_block  0.5901384353637695
generate_one_block  0.5953094959259033
generate_one_block  0.6011371612548828
generate_one_block  0.6106066703796387
generate_one_block  0.6007640361785889
generate_one_block  0.5973517894744873
generate_one_block  0.59786057472229
The real block id is  1
get_global_graph_edges_ids_block function  spend 2.015713691711426
gen group dst list time:  0.12188124656677246
time for parepare:  0.4454350471496582
local_output_nid generation:  0.16373729705810547
local_in_edges_tensor generation:  0.6514308452606201
mini_batch_src_global generation:  0.553809404373169
r_  generation:  7.337394952774048
local_output_nid generation:  0.20238184928894043
local_in_edges_tensor generation:  0.6803815364837646
mini_batch_src_global generation:  0.6900863647460938
r_  generation:  7.6029345989227295
local_output_nid generation:  0.19611120223999023
local_in_edges_tensor generation:  0.5622448921203613
mini_batch_src_global generation:  0.658715009689331
r_  generation:  7.4561638832092285
local_output_nid generation:  0.17188072204589844
local_in_edges_tensor generation:  0.4492461681365967
mini_batch_src_global generation:  0.789177656173706
r_  generation:  7.9901487827301025
local_output_nid generation:  0.19848012924194336
local_in_edges_tensor generation:  0.5763156414031982
mini_batch_src_global generation:  0.76385498046875
r_  generation:  7.8574769496917725
local_output_nid generation:  0.19970369338989258
local_in_edges_tensor generation:  0.5665616989135742
mini_batch_src_global generation:  0.7101731300354004
r_  generation:  7.817675352096558
local_output_nid generation:  0.17228388786315918
local_in_edges_tensor generation:  0.48059940338134766
mini_batch_src_global generation:  0.7187209129333496
r_  generation:  7.804851531982422
local_output_nid generation:  0.1991899013519287
local_in_edges_tensor generation:  0.5596225261688232
mini_batch_src_global generation:  0.7178406715393066
r_  generation:  7.763477802276611
----------------------check_connections_block total spend ----------------------------- 83.92520093917847
generate_one_block  10.068331718444824
generate_one_block  10.027547836303711
generate_one_block  9.968059301376343
generate_one_block  9.694508075714111
generate_one_block  9.978080749511719
generate_one_block  9.550510883331299
generate_one_block  9.960468769073486
generate_one_block  9.731770277023315
The real block id is  0
get_global_graph_edges_ids_block function  spend 2.2225983142852783
gen group dst list time:  0.5161452293395996
time for parepare:  0.4912724494934082
local_output_nid generation:  0.6053793430328369
local_in_edges_tensor generation:  1.509317398071289
mini_batch_src_global generation:  1.16103196144104
r_  generation:  16.227968454360962
local_output_nid generation:  0.631561279296875
local_in_edges_tensor generation:  1.3676426410675049
mini_batch_src_global generation:  1.4959080219268799
r_  generation:  15.980365514755249
local_output_nid generation:  0.5811388492584229
local_in_edges_tensor generation:  1.2059810161590576
mini_batch_src_global generation:  1.434488296508789
r_  generation:  15.920217275619507
local_output_nid generation:  0.6291546821594238
local_in_edges_tensor generation:  1.2462983131408691
mini_batch_src_global generation:  1.5547926425933838
r_  generation:  15.883663892745972
local_output_nid generation:  0.6190931797027588
local_in_edges_tensor generation:  1.2395823001861572
mini_batch_src_global generation:  1.72361421585083
r_  generation:  16.73712396621704
local_output_nid generation:  0.6279022693634033
local_in_edges_tensor generation:  1.2805273532867432
mini_batch_src_global generation:  1.6147150993347168
r_  generation:  16.106712341308594
local_output_nid generation:  0.6128244400024414
local_in_edges_tensor generation:  1.2233116626739502
mini_batch_src_global generation:  1.5383117198944092
r_  generation:  16.122737646102905
local_output_nid generation:  0.6301677227020264
local_in_edges_tensor generation:  1.18776535987854
mini_batch_src_global generation:  1.6000797748565674
r_  generation:  16.10723900794983
----------------------check_connections_block total spend ----------------------------- 179.7800476551056
generate_one_block  21.184176921844482
generate_one_block  21.948491096496582
generate_one_block  20.829632997512817
generate_one_block  20.95088815689087
generate_one_block  20.961564302444458
generate_one_block  21.034461498260498
generate_one_block  21.13765859603882
generate_one_block  21.156947135925293
-----------------------------------------after block dataloader generation 
 Nvidia-smi: 2.0242919921875 GB
    Memory Allocated: 0.0006527900695800781  GigaBytes
Max Memory Allocated: 0.0006527900695800781  GigaBytes

connection checking time:  263.70524859428406
block generation total time  248.18309831619263
average batch blocks generation time:  31.02288728952408
----------------------------------------before batch_pred = model(blocks, batch_inputs) 
 Nvidia-smi: 3.3309326171875 GB
    Memory Allocated: 1.2233095169067383  GigaBytes
Max Memory Allocated: 1.2233095169067383  GigaBytes

Traceback (most recent call last):
  File "pseudo_mini_batch_range_products_sage.py", line 455, in <module>
    main()
  File "pseudo_mini_batch_range_products_sage.py", line 451, in main
    best_test = run(args, device, data)
  File "pseudo_mini_batch_range_products_sage.py", line 276, in run
    batch_pred = model(blocks, batch_inputs)#------------*
  File "/home/cc/.local/lib/python3.6/site-packages/torch/nn/modules/module.py", line 727, in _call_impl
    result = self.forward(*input, **kwargs)
  File "/home/cc/graph_partition_multi_layers/pseudo_mini_batch_full_batch/SAGE/graphsage_model_products.py", line 48, in forward
    x = layer(block, x)
  File "/home/cc/.local/lib/python3.6/site-packages/torch/nn/modules/module.py", line 727, in _call_impl
    result = self.forward(*input, **kwargs)
  File "/home/cc/.local/lib/python3.6/site-packages/dgl/nn/pytorch/conv/sageconv.py", line 258, in forward
    graph.update_all(msg_fn, self._lstm_reducer)
  File "/home/cc/.local/lib/python3.6/site-packages/dgl/heterograph.py", line 4849, in update_all
    ndata = core.message_passing(g, message_func, reduce_func, apply_node_func)
  File "/home/cc/.local/lib/python3.6/site-packages/dgl/core.py", line 337, in message_passing
    ndata = invoke_udf_reduce(g, rfunc, msgdata, orig_nid=orig_nid)
  File "/home/cc/.local/lib/python3.6/site-packages/dgl/core.py", line 143, in invoke_udf_reduce
    bkt_rsts.append(func(nbatch))
  File "/home/cc/.local/lib/python3.6/site-packages/dgl/nn/pytorch/conv/sageconv.py", line 173, in _lstm_reducer
    _, (rst, _) = self.lstm(m, h)
  File "/home/cc/.local/lib/python3.6/site-packages/torch/nn/modules/module.py", line 727, in _call_impl
    result = self.forward(*input, **kwargs)
  File "/home/cc/.local/lib/python3.6/site-packages/torch/nn/modules/rnn.py", line 582, in forward
    self.dropout, self.training, self.bidirectional, self.batch_first)
RuntimeError: CUDA out of memory. Tried to allocate 50.00 MiB (GPU 0; 23.62 GiB total capacity; 20.81 GiB already allocated; 9.44 MiB free; 21.02 GiB reserved in total by PyTorch)
